<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory & FFI Snapshot Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        {{CSS_CONTENT}}
    </style>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        neutral: '#1F2937',
                        'neutral-light': '#F3F4F6',
                        'ffi-red': '#EF4444',
                        'safe-yellow': '#F59E0B',
                        'safe-green': '#10B981',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
        
        // Global data store
        window.analysisData = {{json_data}};
        
        // Data validation and interaction utilities
        window.dataUtils = {
            hasUnsafeFFIData: function() {
                const unsafeData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
                if (!unsafeData) return false;
                
                const summary = unsafeData.summary || {};
                return (summary.unsafe_count > 0 || 
                       summary.ffi_count > 0 || 
                       summary.enhanced_entries > 0 ||
                       summary.boundary_events > 0 ||
                       summary.safety_violations > 0);
            },
            
            hasFFICallFlowData: function() {
                const unsafeData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
                if (!unsafeData) return false;
                
                const enhancedData = unsafeData.enhanced_ffi_data || [];
                const boundaryEvents = unsafeData.boundary_events || [];
                return enhancedData.length > 0 || boundaryEvents.length > 0;
            },
            
            getEmptyStateMessage: function(type) {
                const messages = {
                    'unsafe_ffi': 'No unsafe/FFI code detected in your codebase',
                    'ffi_flow': 'No FFI call flow patterns found in the analysis'
                };
                return messages[type] || 'No data available';
            },
            
            createEmptyStateElement: function(message, icon = 'fa-info-circle') {
                return `
                    <div class="data-empty-state text-center py-12">
                        <div class="mb-4">
                            <i class="fa ${icon} text-6xl text-gray-300"></i>
                        </div>
                        <h3 class="text-lg font-medium text-gray-600 mb-2">${message}</h3>
                        <p class="text-sm text-gray-500">This indicates good memory safety practices in your Rust code.</p>
                    </div>
                `;
            },
            
            // Interactive data filtering and highlighting
            filterDataByRisk: function(riskLevel) {
                const unsafeData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
                if (!unsafeData) return [];
                
                const filtered = [];
                
                // Filter enhanced FFI data by risk level
                if (unsafeData.enhanced_ffi_data) {
                    unsafeData.enhanced_ffi_data.forEach(item => {
                        if (item.source && typeof item.source === 'string') {
                            const riskMatch = item.source.match(/risk_level:\s*(\w+)/i);
                            if (riskMatch && riskMatch[1].toLowerCase() === riskLevel.toLowerCase()) {
                                filtered.push(item);
                            }
                        }
                    });
                }
                
                return filtered;
            },
            
            // Get interactive statistics
            getInteractiveStats: function() {
                const unsafeData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
                if (!unsafeData) return null;
                
                const stats = {
                    totalRiskItems: 0,
                    riskLevels: { low: 0, medium: 0, high: 0 },
                    boundaryEvents: (unsafeData.boundary_events || []).length,
                    safetyViolations: (unsafeData.safety_violations || []).length,
                    ffiPatterns: (unsafeData.ffi_patterns || []).length
                };
                
                // Analyze risk levels from enhanced data
                if (unsafeData.enhanced_ffi_data) {
                    unsafeData.enhanced_ffi_data.forEach(item => {
                        if (item.source && typeof item.source === 'string') {
                            const riskMatch = item.source.match(/risk_level:\s*(\w+)/i);
                            if (riskMatch) {
                                const level = riskMatch[1].toLowerCase();
                                if (stats.riskLevels[level] !== undefined) {
                                    stats.riskLevels[level]++;
                                    stats.totalRiskItems++;
                                }
                            }
                        }
                    });
                }
                
                return stats;
            }
        };
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .hover-lift {
                transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            }
            .hover-lift:hover {
                transform: translateY(-3px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
            .graph-container {
                overflow: auto;
                border-radius: 0.5rem;
            }
            .timeline-item {
                position: relative;
            }
            .timeline-item::before {
                content: '';
                position: absolute;
                left: -29px;
                top: 5px;
                height: 15px;
                width: 15px;
                border-radius: 50%;
            }
            .timeline-line {
                position: absolute;
                left: -22px;
                top: 20px;
                bottom: -10px;
                width: 2px;
            }
            .lifespan-indicator {
                height: 4px;
                border-radius: 2px;
                margin: 2px 0;
                position: relative;
                overflow: hidden;
            }
            .lifespan-indicator::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                background-color: rgba(255,255,255,0.3);
                animation: flow 2s linear infinite;
            }
            @keyframes flow {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }
            .collapsible-content {
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
            }
            .collapsible-content.active {
                max-height: 2000px;
                transition: max-height 0.6s ease-in;
            }
            .rotate-icon {
                transition: transform 0.3s ease;
            }
            .rotate-icon.active {
                transform: rotate(180deg);
            }
            /* SVG Styles */
            .node-ffi {
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .node-ffi rect {
                rx: 4;
                ry: 4;
                stroke-width: 2;
            }
            .node-ffi text {
                font-family: Arial, sans-serif;
                font-size: 12px;
            }
            .node-ffi:hover {
                filter: drop-shadow(0 3px 3px rgba(0,0,0,0.2));
            }
            .edge-ffi {
                stroke-width: 2;
                stroke-opacity: 0.7;
                transition: all 0.3s ease;
            }
            .edge-ffi:hover {
                stroke-opacity: 1;
                stroke-width: 2.5;
            }
            .tooltip-ffi {
                font-family: Arial, sans-serif;
                font-size: 12px;
                padding: 6px;
                background: white;
                border: 1px solid #ddd;
                border-radius: 3px;
                pointer-events: none;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            /* Interactive elements */
            .interactive-card {
                transition: all 0.3s ease;
                cursor: pointer;
            }
            
            .interactive-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            }
            
            .risk-indicator {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 10px;
                font-weight: bold;
                color: white;
                text-transform: uppercase;
            }
            
            .data-empty-state {
                opacity: 0;
                animation: fadeIn 0.5s ease-in-out forwards;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .pulse-animation {
                animation: pulse 2s infinite;
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
            
            /* Enhanced empty state styling */
            .data-empty-state {
                background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                border: 2px dashed #cbd5e0;
                border-radius: 12px;
                margin: 20px 0;
            }
            
            .data-empty-state i {
                margin-bottom: 16px;
                opacity: 0.6;
            }
            
            .data-empty-state h3 {
                font-weight: 600;
                margin-bottom: 8px;
            }
            
            .data-empty-state p {
                max-width: 400px;
                margin: 0 auto;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-neutral">
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-neutral">
                <i class="fa fa-microchip text-primary mr-3"></i>Memory & FFI Snapshot Analysis
            </h1>
            <p class="text-gray-500 mt-1">Complex Types, Lifetimes, Relationships & Unsafe Operations</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Summary Section -->
        <section class="mb-12">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-bar-chart text-primary mr-2"></i>Analysis Summary
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-neutral-light rounded-lg p-4 hover-lift">
                        <p class="text-gray-500 text-sm">Total Complex Types</p>
                        <p class="text-3xl font-bold" id="total-complex-types">5</p>
                    </div>
                    <div class="bg-neutral-light rounded-lg p-4 hover-lift">
                        <p class="text-gray-500 text-sm">Allocations Analyzed</p>
                        <p class="text-3xl font-bold" id="total-allocations">639</p>
                    </div>
                    <div class="bg-neutral-light rounded-lg p-4 hover-lift">
                        <p class="text-gray-500 text-sm">Generic Types</p>
                        <p class="text-3xl font-bold" id="generic-type-count">6</p>
                    </div>
                    <div class="bg-neutral-light rounded-lg p-4 hover-lift border-l-4 border-ffi-red">
                        <p class="text-gray-500 text-sm">Unsafe FFI Entries</p>
                        <p class="text-3xl font-bold" id="unsafe-ffi-count">2</p>
                    </div>
                </div>
                
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium mb-3">Complexity Distribution</h3>
                        <div class="h-64">
                            <canvas id="complexity-chart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium mb-3">Memory Distribution by Type</h3>
                        <div class="h-64">
                            <canvas id="memory-distribution-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Variable Lifecycle Timeline -->
        <section class="mb-12">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-clock-o text-primary mr-2"></i>Variable Lifecycle Timeline
                </h2>
                <div class="overflow-x-auto">
                    <div class="min-w-[800px]">
                        <div class="flex items-end">
                            <!-- Timeline header with time markers -->
                            <div class="w-40 flex-shrink-0 font-medium">Variable</div>
                            <div class="flex-grow flex border-t border-gray-300 relative">
                                <div class="absolute top-0 left-0 w-full flex justify-between text-xs text-gray-500">
                                    <span>0ms</span>
                                    <span>250ms</span>
                                    <span>500ms</span>
                                    <span>750ms</span>
                                    <span>1000ms</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vec Type -->
                        <div class="flex items-end py-3 border-b border-gray-100">
                            <div class="w-40 flex-shrink-0 text-sm">numbers_vec (Vec<i32>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-blue-500" style="width: 80%;" title="Lifetime: 800ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-blue-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Allocated: 0ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-blue-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Deallocated: 800ms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Rc Types -->
                        <div class="flex items-end py-3 border-b border-gray-100">
                            <div class="w-40 flex-shrink-0 text-sm">rc_data (Rc<Vec<i32>>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-yellow-500" style="width: 70%; margin-left: 10%;" title="Lifetime: 700ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-yellow-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Allocated: 100ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-yellow-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Deallocated: 800ms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-end py-3 border-b border-gray-100">
                            <div class="w-40 flex-shrink-0 text-sm">rc_data_clone (Rc<Vec<i32>>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-yellow-500" style="width: 50%; margin-left: 20%;" title="Lifetime: 500ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-yellow-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Cloned: 200ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-yellow-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Dropped: 700ms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Arc Type -->
                        <div class="flex items-end py-3 border-b border-gray-100">
                            <div class="w-40 flex-shrink-0 text-sm">arc_data (Arc<String>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-green-500" style="width: 60%; margin-left: 30%;" title="Lifetime: 600ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-green-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Allocated: 300ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-green-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Deallocated: 900ms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Box Types -->
                        <div class="flex items-end py-3 border-b border-gray-100">
                            <div class="w-40 flex-shrink-0 text-sm">boxed_value (Box<i32>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-purple-500" style="width: 40%; margin-left: 25%;" title="Lifetime: 400ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-purple-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Allocated: 250ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-purple-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Deallocated: 650ms
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-end py-3">
                            <div class="w-40 flex-shrink-0 text-sm">boxed_value2 (Box<i32>)</div>
                            <div class="flex-grow relative">
                                <div class="lifespan-indicator bg-purple-500" style="width: 30%; margin-left: 60%;" title="Lifetime: 300ms">
                                    <div class="absolute -top-6 left-0 text-xs bg-purple-500 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Allocated: 600ms
                                    </div>
                                    <div class="absolute -top-6 right-0 text-xs bg-purple-700 text-white px-2 py-1 rounded whitespace-nowrap">
                                        Deallocated: 900ms
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4 text-sm text-gray-500 italic">
                    <i class="fa fa-info-circle mr-1"></i>
                    Visual representation of variable lifetimes showing allocation/deallocation points and durations
                </div>
            </div>
        </section>

        <!-- Generic Types Table -->
        <section class="mb-12">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-table text-primary mr-2"></i>Generic Types Details
                </h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Variable Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pointer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Size (bytes)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lifetime (ms)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Complexity</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="generic-types-table-body">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Variable Relationship Graph -->
        <section class="mb-12">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-sitemap text-primary mr-2"></i>Variable Relationship Graph
                </h2>
                
                <!-- Graph Controls -->
                <div class="mb-4 flex justify-between items-center">
                    <div class="flex items-center space-x-4 flex-wrap">
                        <div class="text-sm text-gray-600">Click on a node to view details</div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="reset-zoom" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm">Reset View</button>
                        <button id="auto-layout" class="px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-sm">Auto Layout</button>
                    </div>
                </div>

                <!-- Graph Container -->
                <div class="border rounded-lg bg-gradient-to-br from-gray-50 to-gray-100 h-[600px] graph-container relative overflow-hidden">
                    <div id="variable-graph-container" class="w-full h-full"></div>
                    
                    <!-- Node Details Panel -->
                    <div id="node-details" class="absolute top-4 right-4 bg-white rounded-lg shadow-lg p-4 w-64 hidden">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-semibold text-gray-800">Node Details</h4>
                            <button id="close-details" class="text-gray-400 hover:text-gray-600">&times;</button>
                        </div>
                        <div id="node-details-content"></div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-gray-50 rounded-lg p-3">
                        <h4 class="font-semibold text-sm mb-2">Node Size</h4>
                        <p class="text-xs text-gray-600">Size represents complexity score</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3">
                        <h4 class="font-semibold text-sm mb-2">Node Colors</h4>
                        <div class="space-y-1">
                            <div class="flex items-center text-xs">
                                <div class="w-3 h-3 rounded-full bg-blue-500 mr-2"></div>
                                <span>Smart Pointers</span>
                            </div>
                            <div class="flex items-center text-xs">
                                <div class="w-3 h-3 rounded-full bg-green-500 mr-2"></div>
                                <span>Collections</span>
                            </div>
                            <div class="flex items-center text-xs">
                                <div class="w-3 h-3 rounded-full bg-orange-500 mr-2"></div>
                                <span>Primitives</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3">
                        <h4 class="font-semibold text-sm mb-2">Edge Types</h4>
                        <div class="space-y-1">
                            <div class="flex items-center text-xs">
                                <div class="w-4 h-0.5 bg-gray-600 mr-2"></div>
                                <span>Clone</span>
                            </div>
                            <div class="flex items-center text-xs">
                                <div class="w-4 h-0.5 bg-blue-600 mr-2"></div>
                                <span>Similar Type</span>
                            </div>
                            <div class="flex items-center text-xs">
                                <div class="w-4 h-0.5 bg-red-600 mr-2"></div>
                                <span>Contains</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3">
                        <h4 class="font-semibold text-sm mb-2">Relationship Types</h4>
                        <div class="space-y-1">
                            <div class="text-xs">Clone Relationship</div>
                            <div class="text-xs">Type Similarity</div>
                        </div>
                    </div>
                </div>

                <!-- Variable Categories Summary -->
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-blue-800">Smart Pointers</h4>
                                <p class="text-2xl font-bold text-blue-600" id="smart-pointers-count">5</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                <i class="fa fa-share-alt text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-green-800">Collections</h4>
                                <p class="text-2xl font-bold text-green-600" id="collections-count">1</p>
                            </div>
                            <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                <i class="fa fa-list text-white"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-4 border-l-4 border-orange-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-semibold text-orange-800">Primitives</h4>
                                <p class="text-2xl font-bold text-orange-600" id="primitives-count">0</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center">
                                <i class="fa fa-cube text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="border rounded-lg p-4 bg-neutral-light h-[500px] graph-container hidden">
                    <!-- Variable Relationship SVG -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600" width="100%" height="100%">
                        <!-- Definitions -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                                    refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                            </marker>
                            <marker id="dashed-arrow" markerWidth="10" markerHeight="7" 
                                    refX="9" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                            </marker>
                            
                            <!-- Gradients -->
                            <linearGradient id="vecGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3B82F6;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#3B82F6;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="arcGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10B981;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#10B981;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="boxGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#8B5CF6;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="rcGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#F59E0B;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#F59E0B;stop-opacity:0.4" />
                            </linearGradient>
                            <linearGradient id="stringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#EC4899;stop-opacity:0.8" />
                                <stop offset="100%" style="stop-color:#EC4899;stop-opacity:0.4" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Background -->
                        <rect width="100%" height="100%" fill="#fafafa" />
                        <g id="var-zoom-container" transform="translate(0,0) scale(1)">
                            <!-- Subgraphs -->
                            <rect class="subgraph" x="100" y="50" width="300" height="150" fill="rgba(245,245,245,0.5)" stroke="#ccc" />
                            <text class="subgraph-label" x="250" y="70" text-anchor="middle" font-weight="bold">Data Containers</text>
                            
                            <rect class="subgraph" x="500" y="50" width="400" height="500" fill="rgba(245,245,245,0.5)" stroke="#ccc" />
                            <text class="subgraph-label" x="700" y="70" text-anchor="middle" font-weight="bold">Smart Pointers</text>
                            
                            <!-- Nodes -->
                            <g class="node-ffi" id="numbers_vec" data-type="Vec<i32>" data-size="20B" data-ptr="0x145005bd0" data-lifetime="800ms">
                                <rect x="150" y="100" width="200" height="60" fill="url(#vecGradient)" stroke="#3B82F6" />
                                <text x="250" y="125" text-anchor="middle" font-weight="bold">numbers_vec</text>
                                <text x="250" y="145" text-anchor="middle" font-size="12">Vec<i32></text>
                                <text x="250" y="165" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 800ms</text>
                            </g>
                            
                            <g class="node-ffi" id="vec_elements">
                                <rect x="150" y="200" width="200" height="40" fill="url(#vecGradient)" stroke="#3B82F6" />
                                <text x="250" y="225" text-anchor="middle">i32 elements</text>
                                <text x="250" y="240" text-anchor="middle" font-size="11">(dynamic array)</text>
                            </g>
                            
                            <g class="node-ffi" id="rc_data" data-type="Rc<Vec<i32>>" data-size="56B" data-ptr="0x5dd34c26" data-lifetime="700ms">
                                <rect x="550" y="100" width="200" height="60" fill="url(#rcGradient)" stroke="#F59E0B" />
                                <text x="650" y="125" text-anchor="middle" font-weight="bold">rc_data</text>
                                <text x="650" y="145" text-anchor="middle" font-size="12">Rc<Vec<i32>></text>
                                <text x="650" y="165" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 700ms</text>
                            </g>
                            
                            <g class="node-ffi" id="rc_data_clone" data-type="Rc<Vec<i32>>" data-size="56B" data-ptr="0x5dd34d06" data-lifetime="500ms">
                                <rect x="550" y="220" width="200" height="60" fill="url(#rcGradient)" stroke="#F59E0B" />
                                <text x="650" y="245" text-anchor="middle" font-weight="bold">rc_data_clone</text>
                                <text x="650" y="265" text-anchor="middle" font-size="12">Rc<Vec<i32>></text>
                                <text x="650" y="285" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 500ms</text>
                            </g>
                            
                            <g class="node-ffi" id="rc_count">
                                <rect x="780" y="140" width="100" height="40" fill="url(#rcGradient)" stroke="#F59E0B" />
                                <text x="830" y="165" text-anchor="middle">Ref count: 2</text>
                            </g>
                            
                            <g class="node-ffi" id="arc_data" data-type="Arc<String>" data-size="56B" data-ptr="0x6dd34c96" data-lifetime="600ms">
                                <rect x="550" y="340" width="200" height="60" fill="url(#arcGradient)" stroke="#10B981" />
                                <text x="650" y="365" text-anchor="middle" font-weight="bold">arc_data</text>
                                <text x="650" y="385" text-anchor="middle" font-size="12">Arc<String></text>
                                <text x="650" y="405" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 600ms</text>
                            </g>
                            
                            <g class="node-ffi" id="string_data" data-type="String" data-size="~19B" data-lifetime="600ms">
                                <rect x="550" y="460" width="200" height="40" fill="url(#stringGradient)" stroke="#EC4899" />
                                <text x="650" y="485" text-anchor="middle">String data</text>
                                <text x="650" y="505" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 600ms</text>
                            </g>
                            
                            <g class="node-ffi" id="arc_count">
                                <rect x="780" y="380" width="100" height="40" fill="url(#arcGradient)" stroke="#10B981" />
                                <text x="830" y="405" text-anchor="middle">Atomic count: 1</text>
                            </g>
                            
                            <g class="node-ffi" id="boxed_value" data-type="Box<i32>" data-size="4B" data-ptr="0x123e04720" data-lifetime="400ms">
                                <rect x="550" y="520" width="200" height="60" fill="url(#boxGradient)" stroke="#8B5CF6" />
                                <text x="650" y="545" text-anchor="middle" font-weight="bold">boxed_value</text>
                                <text x="650" y="565" text-anchor="middle" font-size="12">Box<i32></text>
                                <text x="650" y="585" text-anchor="middle" font-size="10" fill="#ffffff80">Lifetime: 400ms</text>
                            </g>
                            
                            <!-- Connections -->
                            <path class="edge-ffi" d="M250,160 L250,200" stroke="#3B82F6" marker-end="url(#arrowhead)" />
                            <text x="265" y="180" text-anchor="start" font-size="12">contains</text>
                            
                            <path class="edge-ffi" d="M550,130 L350,130" stroke="#F59E0B" marker-end="url(#arrowhead)" />
                            <text x="450" y="120" text-anchor="middle" font-size="12">points to</text>
                            
                            <path class="edge-ffi" d="M650,160 L650,220" stroke="#F59E0B" stroke-dasharray="5,3" marker-end="url(#dashed-arrow)" />
                            <text x="665" y="190" text-anchor="start" font-size="12">cloned to</text>
                            
                            <path class="edge-ffi" d="M750,130 L780,130 L780,160" stroke="#F59E0B" marker-end="url(#arrowhead)" />
                            <text x="765" y="120" text-anchor="middle" font-size="12">ref count</text>
                            
                            <path class="edge-ffi" d="M650,400 L650,460" stroke="#10B981" marker-end="url(#arrowhead)" />
                            <text x="665" y="430" text-anchor="start" font-size="12">points to</text>
                            
                            <path class="edge-ffi" d="M750,370 L780,370 L780,390" stroke="#10B981" marker-end="url(#arrowhead)" />
                            <text x="765" y="360" text-anchor="middle" font-size="12">atomic count</text>
                        </g>
                        
                        <!-- Tooltip -->
                        <g id="var-tooltip" class="tooltip-ffi" visibility="hidden">
                            <rect id="var-tooltip-bg" rx="3" ry="3" fill="white" />
                            <text id="var-tooltip-text" x="8" y="16"></text>
                        </g>
                    </svg>
                </div>
                <div class="mt-4 text-sm text-gray-500 italic">
                    <i class="fa fa-info-circle mr-1"></i>
                    Tip: Click and drag to pan, scroll to zoom, hover over nodes for details including lifetimes
                </div>
            </div>
        </section>

        <!-- Unsafe/FFI Analysis Section -->
        <section class="mb-12" id="unsafe-ffi-section">
            <div class="bg-gradient-to-br from-slate-900 to-slate-800 rounded-xl p-6 card-shadow text-white">
                <h2 class="text-xl font-semibold mb-6 flex items-center text-white">
                    <i class="fa fa-exclamation-triangle text-red-400 mr-2"></i>Unsafe/FFI Analysis
                </h2>
                
                <!-- Dynamic Content Container -->
                <div id="unsafe-ffi-content">
                    <!-- Content will be populated by JavaScript based on data availability -->
                </div>
            </div>
        </section>

        <!-- FFI Call Flow Visualization Section -->
        <section class="mb-12" id="ffi-flow-section">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-6 flex items-center">
                    <i class="fa fa-sitemap text-primary mr-2"></i>FFI Call Flow Visualization
                </h2>
                
                <!-- Dynamic Content Container -->
                <div id="ffi-flow-content">
                    <!-- Content will be populated by JavaScript based on data availability -->
                </div>
            </div>
        </section>

        <!-- Optimization Recommendations -->
        <section>
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fa fa-lightbulb-o text-primary mr-2"></i>Optimization Recommendations
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-medium text-lg mb-3">Memory Optimization</h3>
                        <ul class="list-disc pl-5 space-y-2" id="memory-optimization-recommendations">
                            <!-- Will be populated by JavaScript -->
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-medium text-lg mb-3">FFI Safety Improvements</h3>
                        <ul class="list-disc pl-5 space-y-2 text-ffi-red" id="ffi-optimization-recommendations">
                            <li>Replace manual memory management with RAII patterns</li>
                            <li>Add proper error handling around FFI boundaries</li>
                            <li>Consider using safer wrappers for libc functions</li>
                            <li>Implement proper memory cleanup for FFI allocations</li>
                            <li>Add validation for data crossing FFI boundaries</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-neutral text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <p class="text-center">Memory & FFI Snapshot Visualization Tool</p>
            <p class="text-center text-gray-400 text-sm mt-2">Generated from memory_analysis_snapshot.json</p>
        </div>
    </footer>

    <script>
        // Embedded JSON data from Rust (will be replaced by build process)
        const embeddedJsonData = {{json_data}};

        // Function to use embedded data if available, otherwise fall back to fake data
        function getComplexTypesData() {
            if (embeddedJsonData && embeddedJsonData.complex_types) {
                console.log('Using embedded complex types data');
                return embeddedJsonData.complex_types;
            }
            console.log('Using fallback fake complex types data');
            return complexTypesDataFallback;
        }

        function getFfiSnapshotData() {
            if (embeddedJsonData && embeddedJsonData.unsafe_ffi && embeddedJsonData.unsafe_ffi.enhanced_ffi_data) {
                console.log('Using embedded FFI data');
                return embeddedJsonData.unsafe_ffi.enhanced_ffi_data;
            }
            console.log('Using fallback fake FFI data');
            return ffiSnapshotDataFallback;
        }

        // Fallback fake data (renamed to avoid conflicts)
        const complexTypesDataFallback = {
            "categorized_types": {
                "collections": [],
                "generic_types": [
                    {
                        "complexity_score": 6,
                        "normalized_type": "alloc::vec::Vec<T>",
                        "ptr": "0x145005bd0",
                        "size": 20,
                        "type_name": "alloc::vec::Vec<i32>",
                        "var_name": "numbers_vec",
                        "lifetime_ms": 800
                    },
                    {
                        "complexity_score": 10,
                        "normalized_type": "alloc::sync::Arc<T>",
                        "ptr": "0x6dd34c96",
                        "size": 56,
                        "type_name": "alloc::sync::Arc<alloc::string::String>",
                        "var_name": "arc_data",
                        "lifetime_ms": 600
                    },
                    {
                        "complexity_score": 8,
                        "normalized_type": "alloc::boxed::Box<T>",
                        "ptr": "0x123e04720",
                        "size": 4,
                        "type_name": "alloc::boxed::Box<i32>",
                        "var_name": "boxed_value",
                        "lifetime_ms": 400
                    },
                    {
                        "complexity_score": 14,
                        "normalized_type": "alloc::rc::Rc<T>",
                        "ptr": "0x5dd34c26",
                        "size": 56,
                        "type_name": "alloc::rc::Rc<alloc::vec::Vec<i32>>",
                        "var_name": "rc_data",
                        "lifetime_ms": 700
                    },
                    {
                        "complexity_score": 14,
                        "normalized_type": "alloc::rc::Rc<T>",
                        "ptr": "0x5dd34d06",
                        "size": 56,
                        "type_name": "alloc::rc::Rc<alloc::vec::Vec<i32>>",
                        "var_name": "rc_data_clone",
                        "lifetime_ms": 500
                    },
                    {
                        "complexity_score": 8,
                        "normalized_type": "alloc::boxed::Box<T>",
                        "ptr": "0x123e05460",
                        "size": 4,
                        "type_name": "alloc::boxed::Box<i32>",
                        "var_name": "boxed_value2",
                        "lifetime_ms": 300
                    }
                ],
                "smart_pointers": [],
                "trait_objects": []
            },
            "complex_type_analysis": [
                {
                    "allocation_count": 2,
                    "average_size": 56,
                    "category": "Generic",
                    "complexity_score": 14,
                    "max_size": 56,
                    "memory_efficiency": 80,
                    "optimization_suggestions": [
                        "High complexity type - consider simplifying or using type aliases"
                    ],
                    "total_size": 112,
                    "type_name": "alloc::rc::Rc<T>"
                },
                {
                    "allocation_count": 1,
                    "average_size": 56,
                    "category": "Generic",
                    "complexity_score": 10,
                    "max_size": 56,
                    "memory_efficiency": 80,
                    "optimization_suggestions": [],
                    "total_size": 56,
                    "type_name": "alloc::sync::Arc<T>"
                },
                {
                    "allocation_count": 2,
                    "average_size": 4,
                    "category": "Generic",
                    "complexity_score": 8,
                    "max_size": 4,
                    "memory_efficiency": 90,
                    "optimization_suggestions": [],
                    "total_size": 8,
                    "type_name": "alloc::boxed::Box<T>"
                },
                {
                    "allocation_count": 1,
                    "average_size": 20,
                    "category": "Generic",
                    "complexity_score": 6,
                    "max_size": 20,
                    "memory_efficiency": 60,
                    "optimization_suggestions": [],
                    "total_size": 20,
                    "type_name": "alloc::vec::Vec<T>"
                },
                {
                    "allocation_count": 1,
                    "average_size": 19,
                    "category": "Simple",
                    "complexity_score": 1,
                    "max_size": 19,
                    "memory_efficiency": 85,
                    "optimization_suggestions": [],
                    "total_size": 19,
                    "type_name": "String"
                }
            ],
            "metadata": {
                "analysis_type": "complex_types_analysis_optimized",
                "export_version": "2.0",
                "optimization_level": "high",
                "processing_mode": "sequential",
                "timestamp": 1753328255,
                "total_allocations_analyzed": 639,
                "unique_complex_types": 5
            },
            "optimization_recommendations": [
                "Use 'cargo clippy' to identify additional optimization opportunities",
                "Consider profiling with 'perf' or 'valgrind' for detailed performance analysis",
                "Optimize Vec capacity to improve memory efficiency",
                "Use appropriate smart pointers based on concurrency requirements"
            ],
            "summary": {
                "collection_count": 0,
                "complexity_distribution": {
                    "high_complexity": 3,
                    "low_complexity": 1,
                    "medium_complexity": 1,
                    "very_high_complexity": 0
                },
                "generic_type_count": 6,
                "smart_pointer_count": 0,
                "total_complex_types": 5,
                "trait_object_count": 0
            }
        };

        // Fallback fake FFI data
        const ffiSnapshotDataFallback = [
            {
                "base": {
                    "ptr": 5408595456,
                    "size": 256,
                    "var_name": null,
                    "type_name": null,
                    "scope_name": null,
                    "timestamp_alloc": 1753414296355925000,
                    "timestamp_dealloc": null,
                    "borrow_count": 0,
                    "stack_trace": null,
                    "is_leaked": false,
                    "lifetime_ms": null,
                    "smart_pointer_info": null,
                    "memory_layout": null,
                    "generic_info": null,
                    "dynamic_type_info": null,
                    "runtime_state": null,
                    "stack_allocation": null,
                    "temporary_object": null,
                    "fragmentation_analysis": null,
                    "generic_instantiation": null,
                    "type_relationships": null,
                    "type_usage": null,
                    "function_call_tracking": null,
                    "lifecycle_tracking": null,
                    "access_tracking": null
                },
                "source": {
                    "FfiC": {
                        "library_name": "libc",
                        "function_name": "malloc",
                        "call_stack": [
                            {
                                "function_name": "current_function",
                                "file_name": "src/unsafe_ffi_tracker.rs",
                                "line_number": 42,
                                "is_unsafe": true
                            }
                        ],
                        "libc_hook_info": {
                            "hook_method": "DynamicLinker",
                            "original_function": "malloc",
                            "hook_timestamp": 1753414296355937000,
                            "allocation_metadata": {
                                "requested_size": 256,
                                "actual_size": 256,
                                "alignment": 8,
                                "allocator_info": "libc malloc",
                                "protection_flags": {
                                    "readable": true,
                                    "writable": true,
                                    "executable": false,
                                    "shared": false
                                }
                            },
                            "hook_overhead_ns": 100
                        }
                    }
                },
                "call_stack": [
                    {
                        "function_name": "current_function",
                        "file_name": "src/unsafe_ffi_tracker.rs",
                        "line_number": 42,
                        "is_unsafe": true
                    }
                ],
                "cross_boundary_events": [
                    {
                        "event_type": "FfiToRust",
                        "timestamp": 1753414296356,
                        "from_context": "libc",
                        "to_context": "rust_main",
                        "stack": [
                            {
                                "function_name": "current_function",
                                "file_name": "src/unsafe_ffi_tracker.rs",
                                "line_number": 42,
                                "is_unsafe": true
                            }
                        ]
                    }
                ],
                "safety_violations": [],
                "ffi_tracked": true,
                "memory_passport": null,
                "ownership_history": null
            },
            {
                "base": {
                    "ptr": 5408583952,
                    "size": 40,
                    "var_name": null,
                    "type_name": null,
                    "scope_name": null,
                    "timestamp_alloc": 1753414296355789000,
                    "timestamp_dealloc": null,
                    "borrow_count": 0,
                    "stack_trace": null,
                    "is_leaked": false,
                    "lifetime_ms": null,
                    "smart_pointer_info": null,
                    "memory_layout": null,
                    "generic_info": null,
                    "dynamic_type_info": null,
                    "runtime_state": null,
                    "stack_allocation": null,
                    "temporary_object": null,
                    "fragmentation_analysis": null,
                    "generic_instantiation": null,
                    "type_relationships": null,
                    "type_usage": null,
                    "function_call_tracking": null,
                    "lifecycle_tracking": null,
                    "access_tracking": null
                },
                "source": {
                    "UnsafeRust": {
                        "unsafe_block_location": "examples/unsafe_ffi_demo.rs:37:13",
                        "call_stack": [
                            {
                                "function_name": "current_function",
                                "file_name": "src/unsafe_ffi_tracker.rs",
                                "line_number": 42,
                                "is_unsafe": true
                            }
                        ],
                        "risk_assessment": {
                            "risk_level": "Medium",
                            "risk_factors": [
                                {
                                    "factor_type": "ManualMemoryManagement",
                                    "severity": 5.0,
                                    "description": "Manual memory management in unsafe block",
                                    "source_location": "examples/unsafe_ffi_demo.rs:37:13"
                                }
                            ],
                            "mitigation_suggestions": [
                                "Ensure proper memory cleanup",
                                "Use RAII patterns where possible"
                            ],
                            "confidence_score": 0.7,
                            "assessment_timestamp": 1753414296355826000
                        }
                    }
                },
                "call_stack": [
                    {
                        "function_name": "current_function",
                        "file_name": "src/unsafe_ffi_tracker.rs",
                        "line_number": 42,
                        "is_unsafe": true
                    }
                ],
                "cross_boundary_events": [
                    {
                        "event_type": "RustToFfi",
                        "timestamp": 1753414296355,
                        "from_context": "unsafe_rust_block",
                        "to_context": "potential_ffi_target",
                        "stack": [
                            {
                                "function_name": "current_function",
                                "file_name": "src/unsafe_ffi_tracker.rs",
                                "line_number": 42,
                                "is_unsafe": true
                            }
                        ]
                    }
                ],
                "safety_violations": [],
                "ffi_tracked": false,
                "memory_passport": null,
                "ownership_history": null
            }
        ];

        // Use embedded data if available, otherwise use fallback
        const complexTypesData = getComplexTypesData();
        const ffiSnapshotData = getFfiSnapshotData();

        // Populate summary data
        document.getElementById('total-complex-types').textContent = 
            complexTypesData.summary.total_complex_types;
        document.getElementById('total-allocations').textContent = 
            complexTypesData.metadata.total_allocations_analyzed;
        document.getElementById('generic-type-count').textContent = 
            complexTypesData.summary.generic_type_count;
        document.getElementById('unsafe-ffi-count').textContent = 
            ffiSnapshotData.length;

        // Populate generic types table with lifetime information
        const tableBody = document.getElementById('generic-types-table-body');
        complexTypesData.categorized_types.generic_types.forEach(type => {
            let typeClass = '';
            if (type.type_name.includes('Vec')) typeClass = 'bg-blue-50';
            else if (type.type_name.includes('Arc')) typeClass = 'bg-green-50';
            else if (type.type_name.includes('Box')) typeClass = 'bg-purple-50';
            else if (type.type_name.includes('Rc')) typeClass = 'bg-yellow-50';
            
            const row = document.createElement('tr');
            row.className = `hover:bg-gray-50 transition-colors ${typeClass}`;
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="font-medium text-neutral">${type.var_name}</div>
                </td>
                <td class="px-6 py-4">
                    <div class="text-sm text-gray-900 break-all max-w-xs">${type.type_name}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${type.ptr}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${type.size}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${type.lifetime_ms}ms
                    <div class="lifespan-indicator bg-gray-300 mt-1">
                        <div class="h-full" style="width: ${Math.min(100, type.lifetime_ms)}%; background-color: ${
                            type.type_name.includes('Vec') ? '#3B82F6' :
                            type.type_name.includes('Arc') ? '#10B981' :
                            type.type_name.includes('Box') ? '#8B5CF6' :
                            '#F59E0B'
                        }"></div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                        ${type.complexity_score > 10 ? 'bg-red-100 text-red-800' : 
                          type.complexity_score > 5 ? 'bg-yellow-100 text-yellow-800' : 
                          'bg-green-100 text-green-800'}">
                        ${type.complexity_score}
                    </span>
                </td>
            `;
            tableBody.appendChild(row);
        });

        // Populate optimization recommendations
        const memoryRecList = document.getElementById('memory-optimization-recommendations');
        complexTypesData.optimization_recommendations.forEach(rec => {
            const li = document.createElement('li');
            li.className = 'text-gray-700';
            li.textContent = rec;
            memoryRecList.appendChild(li);
        });

        // Create complexity distribution chart
        const complexityCtx = document.getElementById('complexity-chart').getContext('2d');
        new Chart(complexityCtx, {
            type: 'bar',
            data: {
                labels: ['Low', 'Medium', 'High', 'Very High'],
                datasets: [{
                    label: 'Number of Types',
                    data: [
                        complexTypesData.summary.complexity_distribution.low_complexity,
                        complexTypesData.summary.complexity_distribution.medium_complexity,
                        complexTypesData.summary.complexity_distribution.high_complexity,
                        complexTypesData.summary.complexity_distribution.very_high_complexity
                    ],
                    backgroundColor: [
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(59, 130, 246, 0.7)',
                        'rgba(245, 158, 11, 0.7)',
                        'rgba(239, 68, 68, 0.7)'
                    ],
                    borderColor: [
                        'rgb(16, 185, 129)',
                        'rgb(59, 130, 246)',
                        'rgb(245, 158, 11)',
                        'rgb(239, 68, 68)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Create memory distribution chart
        const memoryCtx = document.getElementById('memory-distribution-chart').getContext('2d');
        new Chart(memoryCtx, {
            type: 'pie',
            data: {
                labels: complexTypesData.complex_type_analysis.map(a => a.type_name),
                datasets: [{
                    data: complexTypesData.complex_type_analysis.map(a => a.total_size),
                    backgroundColor: [
                        'rgba(245, 158, 11, 0.7)',  // Rc - yellow
                        'rgba(16, 185, 129, 0.7)',  // Arc - green
                        'rgba(139, 92, 246, 0.7)',  // Box - purple
                        'rgba(59, 130, 246, 0.7)',  // Vec - blue
                        'rgba(236, 72, 153, 0.7)'   // String - pink
                    ],
                    borderColor: [
                        'rgb(245, 158, 11)',
                        'rgb(16, 185, 129)',
                        'rgb(139, 92, 246)',
                        'rgb(59, 130, 246)',
                        'rgb(236, 72, 153)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const value = context.raw;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = Math.round((value / total) * 100);
                                return `${context.label}: ${value} bytes (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Render FFI data with collapsible sections
        function renderFfiData(data, container) {
            data.forEach((item, index) => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'bg-white rounded-lg card-shadow hover-lift border-l-4 ' + 
                                    (item.source.FfiC ? 'border-blue-500' : 'border-yellow-500');
                
                const sourceType = item.source.FfiC ? 'FFI (C)' : 'Unsafe Rust';
                const sourceColor = item.source.FfiC ? 'text-blue-500' : 'text-yellow-500';
                
                // Create header with toggle button
                const headerDiv = document.createElement('div');
                headerDiv.className = 'p-5 cursor-pointer flex justify-between items-center';
                headerDiv.innerHTML = `
                    <div class="font-semibold text-lg ${sourceColor}">Entry ${index + 1}: ${sourceType}</div>
                    <i class="fa fa-chevron-down rotate-icon"></i>
                `;
                entryDiv.appendChild(headerDiv);
                
                // Create collapsible content
                const contentDiv = document.createElement('div');
                contentDiv.className = 'collapsible-content px-5 pb-5 border-t border-gray-100';
                entryDiv.appendChild(contentDiv);
                
                // Render the data inside collapsible content
                renderFfiObject(item, contentDiv);
                container.appendChild(entryDiv);
                
                // Add click handler for toggle
                headerDiv.addEventListener('click', () => {
                    contentDiv.classList.toggle('active');
                    headerDiv.querySelector('.rotate-icon').classList.toggle('active');
                });
            });
        }

        function renderFfiObject(obj, container, level = 0) {
            // Limit nesting depth to prevent excessive expansion
            if (level > 3) {
                const moreDiv = document.createElement('div');
                moreDiv.className = 'text-gray-500 text-sm italic mt-1';
                moreDiv.textContent = '(Content truncated for readability)';
                container.appendChild(moreDiv);
                return;
            }
            
            for (const [key, value] of Object.entries(obj)) {
                // Skip null values and empty objects
                if (value === null || (typeof value === 'object' && Object.keys(value).length === 0)) {
                    continue;
                }
                
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'mb-4';
                
                const keyDiv = document.createElement('div');
                keyDiv.className = 'font-medium text-neutral mb-2';
                keyDiv.textContent = key.charAt(0).toUpperCase() + key.slice(1);
                sectionDiv.appendChild(keyDiv);

                const valueDiv = document.createElement('div');
                valueDiv.className = 'pl-4 border-l-2 border-gray-200';

                if (typeof value === 'object') {
                    if (Array.isArray(value)) {
                        // For arrays, show count and allow expansion
                        const arrayHeader = document.createElement('div');
                        arrayHeader.className = 'font-medium text-sm text-gray-600 cursor-pointer flex items-center';
                        arrayHeader.innerHTML = `
                            Array (${value.length} items)
                            <i class="fa fa-chevron-down rotate-icon ml-2 text-xs"></i>
                        `;
                        valueDiv.appendChild(arrayHeader);
                        
                        const arrayContent = document.createElement('div');
                        arrayContent.className = 'collapsible-content mt-2';
                        valueDiv.appendChild(arrayContent);
                        
                        value.forEach((item, idx) => {
                            const arrayItemDiv = document.createElement('div');
                            arrayItemDiv.className = 'mb-3';
                            arrayItemDiv.innerHTML = `<div class="font-medium text-sm text-gray-600">Item ${idx + 1}:</div>`;
                            renderFfiObject(item, arrayItemDiv, level + 1);
                            arrayContent.appendChild(arrayItemDiv);
                        });
                        
                        // Add click handler for array toggle
                        arrayHeader.addEventListener('click', () => {
                            arrayContent.classList.toggle('active');
                            arrayHeader.querySelector('.rotate-icon').classList.toggle('active');
                        });
                    } else {
                        // For objects, create a toggleable section
                        const objectHeader = document.createElement('div');
                        objectHeader.className = 'font-medium text-sm text-gray-600 cursor-pointer flex items-center';
                        objectHeader.innerHTML = `
                            Object
                            <i class="fa fa-chevron-down rotate-icon ml-2 text-xs"></i>
                        `;
                        valueDiv.appendChild(objectHeader);
                        
                        const objectContent = document.createElement('div');
                        objectContent.className = 'collapsible-content mt-2';
                        valueDiv.appendChild(objectContent);
                        
                        renderFfiObject(value, objectContent, level + 1);
                        
                        // Add click handler for object toggle
                        objectHeader.addEventListener('click', () => {
                            objectContent.classList.toggle('active');
                            objectHeader.querySelector('.rotate-icon').classList.toggle('active');
                        });
                    }
                } else {
                    // For primitive values, just display them
                    valueDiv.textContent = value;
                }

                sectionDiv.appendChild(valueDiv);
                container.appendChild(sectionDiv);
            }
        }

        renderFfiData(ffiSnapshotData, document.getElementById('ffi-data-render'));

        // Modern Variable Relationship Graph using D3.js
        function initModernVariableGraph() {
            const container = d3.select("#variable-graph-container");
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;

            // Clear any existing content
            container.selectAll("*").remove();

            // Create SVG
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height)
                .style("background", "linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)");

            // Create zoom behavior
            const zoom = d3.zoom()
                .scaleExtent([0.5, 3])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });

            svg.call(zoom);

            const g = svg.append("g");

            // Get data from complexTypesData
            const nodes = [];
            const links = [];
            
            if (complexTypesData && complexTypesData.categorized_types && complexTypesData.categorized_types.generic_types) {
                complexTypesData.categorized_types.generic_types.forEach((type, index) => {
                    const category = getNodeCategory(type.type_name);
                    nodes.push({
                        id: type.var_name,
                        name: type.var_name,
                        type: type.type_name,
                        size: type.size || 20,
                        complexity: type.complexity_score || 1,
                        lifetime: type.lifetime_ms || 0,
                        ptr: type.ptr,
                        category: category,
                        color: getCategoryColor(category)
                    });

                    // Create links based on type relationships
                    if (index > 0 && type.type_name.includes("Rc") && nodes[index-1].type.includes("Vec")) {
                        links.push({
                            source: nodes[index-1].id,
                            target: type.var_name,
                            type: "points_to",
                            strength: 0.8
                        });
                    }
                    
                    // Clone relationships
                    if (type.var_name.includes("clone")) {
                        const originalName = type.var_name.replace("_clone", "");
                        const originalNode = nodes.find(n => n.name === originalName);
                        if (originalNode) {
                            links.push({
                                source: originalName,
                                target: type.var_name,
                                type: "clone",
                                strength: 0.6
                            });
                        }
                    }
                });
            }

            // Create force simulation
            const simulation = d3.forceSimulation(nodes)
                .force("link", d3.forceLink(links).id(d => d.id).distance(100).strength(0.5))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => Math.sqrt(d.complexity) * 8 + 10));

            // Create links
            const link = g.append("g")
                .selectAll("line")
                .data(links)
                .enter().append("line")
                .attr("stroke", d => getLinkColor(d.type))
                .attr("stroke-width", 2)
                .attr("stroke-dasharray", d => d.type === "clone" ? "5,5" : "none")
                .attr("opacity", 0.6);

            // Create nodes
            const node = g.append("g")
                .selectAll("g")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .style("cursor", "pointer")
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            // Add circles to nodes
            node.append("circle")
                .attr("r", d => Math.sqrt(d.complexity) * 8 + 10)
                .attr("fill", d => d.color)
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .style("filter", "drop-shadow(0 2px 4px rgba(0,0,0,0.1))");

            // Add labels to nodes
            node.append("text")
                .text(d => d.name)
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .attr("font-size", "12px")
                .attr("font-weight", "bold")
                .attr("fill", "#fff")
                .style("pointer-events", "none");

            // Add size labels
            node.append("text")
                .text(d => `${d.size}B`)
                .attr("text-anchor", "middle")
                .attr("dy", "1.5em")
                .attr("font-size", "10px")
                .attr("fill", "#fff")
                .attr("opacity", 0.8)
                .style("pointer-events", "none");

            // Node click handler
            node.on("click", function(event, d) {
                showNodeDetails(d);
            });

            // Update positions on simulation tick
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                node
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });

            // Drag functions
            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }

            // Reset zoom button
            d3.select("#reset-zoom").on("click", () => {
                svg.transition().duration(750).call(
                    zoom.transform,
                    d3.zoomIdentity
                );
            });

            // Auto layout button
            d3.select("#auto-layout").on("click", () => {
                simulation.alpha(1).restart();
            });

            return { svg, simulation, nodes, links };
        }

        // Helper functions
        function getNodeCategory(typeName) {
            if (typeName.includes("Arc") || typeName.includes("Rc") || typeName.includes("Box")) {
                return "smart_pointers";
            } else if (typeName.includes("Vec") || typeName.includes("HashMap")) {
                return "collections";
            } else {
                return "primitives";
            }
        }

        function getCategoryColor(category) {
            const colors = {
                smart_pointers: "#3B82F6",
                collections: "#10B981", 
                primitives: "#F59E0B"
            };
            return colors[category] || "#6B7280";
        }

        function getLinkColor(linkType) {
            const colors = {
                clone: "#6B7280",
                points_to: "#EF4444",
                similar_type: "#3B82F6"
            };
            return colors[linkType] || "#6B7280";
        }

        function showNodeDetails(node) {
            const detailsPanel = document.getElementById("node-details");
            const detailsContent = document.getElementById("node-details-content");
            
            detailsContent.innerHTML = `
                <div class="space-y-2">
                    <div><strong>Name:</strong> ${node.name}</div>
                    <div><strong>Type:</strong> ${node.type}</div>
                    <div><strong>Size:</strong> ${node.size} bytes</div>
                    <div><strong>Complexity:</strong> ${node.complexity}</div>
                    <div><strong>Lifetime:</strong> ${node.lifetime}ms</div>
                    <div><strong>Pointer:</strong> ${node.ptr}</div>
                    <div><strong>Category:</strong> ${node.category.replace('_', ' ')}</div>
                </div>
            `;
            
            detailsPanel.classList.remove("hidden");
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener("DOMContentLoaded", () => {
            // Initialize unsafe/FFI sections with data checking
            initUnsafeFFISections();
            
            // Initialize FFI dashboard
            initFFIDashboard();
            
            // Close details panel event handler
            document.getElementById("close-details")?.addEventListener("click", () => {
                document.getElementById("node-details").classList.add("hidden");
            });
            
            // Update summary statistics based on actual data
            updateSummaryStatistics();
        });

        // Create interactive charts for unsafe/FFI data
        function createUnsafeFFIInteractiveCharts(unsafeFFIData) {
            if (!unsafeFFIData || !unsafeFFIData.summary) return;
            
            const summary = unsafeFFIData.summary;
            const enhancedData = unsafeFFIData.enhanced_ffi_data || [];
            const boundaryEvents = unsafeFFIData.boundary_events || [];
            
            // Create risk assessment visualization
            createRiskAssessmentChart(summary);
            
            // Create timeline visualization if we have events
            if (enhancedData.length > 0 || boundaryEvents.length > 0) {
                createFFITimelineVisualization(enhancedData, boundaryEvents);
            }
            
            // Add interactive tooltips to existing elements
            addInteractiveTooltips();
        }
        
        // Create risk assessment chart
        function createRiskAssessmentChart(summary) {
            const riskLevel = summary.risk_assessment || 'low';
            const riskColors = {
                'low': '#10B981',
                'medium': '#F59E0B', 
                'high': '#EF4444'
            };
            
            // Add risk indicator to the dashboard
            const dashboardContent = document.getElementById('ffi-dashboard-content');
            if (dashboardContent && summary.total_risk_items > 0) {
                const riskIndicator = document.createElement('div');
                riskIndicator.className = 'mb-4 p-3 rounded-lg border-l-4';
                riskIndicator.style.borderColor = riskColors[riskLevel];
                riskIndicator.style.backgroundColor = riskColors[riskLevel] + '10';
                
                riskIndicator.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <span class="risk-indicator" style="background-color: ${riskColors[riskLevel]}">
                                ${riskLevel.toUpperCase()} RISK
                            </span>
                            <span class="ml-2 text-sm text-gray-600">
                                ${summary.total_risk_items} risk items detected
                            </span>
                        </div>
                        <i class="fa fa-exclamation-triangle" style="color: ${riskColors[riskLevel]}"></i>
                    </div>
                `;
                
                dashboardContent.prepend(riskIndicator);
            }
        }
        
        // Create FFI timeline visualization
        function createFFITimelineVisualization(enhancedData, boundaryEvents) {
            // This would create an interactive timeline
            // For now, we'll enhance the existing timeline with real data
            console.log('Creating FFI timeline with', enhancedData.length, 'enhanced events and', boundaryEvents.length, 'boundary events');
        }
        
        // Add interactive tooltips
        function addInteractiveTooltips() {
            // Add hover effects to FFI nodes
            document.querySelectorAll('.node-ffi').forEach(node => {
                node.addEventListener('mouseenter', function(e) {
                    const info = this.getAttribute('data-info');
                    if (info) {
                        // Create tooltip (simplified implementation)
                        const tooltip = document.createElement('div');
                        tooltip.className = 'tooltip-ffi';
                        tooltip.textContent = info;
                        tooltip.style.position = 'absolute';
                        tooltip.style.zIndex = '1000';
                        document.body.appendChild(tooltip);
                        
                        // Position tooltip
                        const rect = this.getBoundingClientRect();
                        tooltip.style.left = rect.left + 'px';
                        tooltip.style.top = (rect.top - 30) + 'px';
                    }
                });
                
                node.addEventListener('mouseleave', function() {
                    document.querySelectorAll('.tooltip-ffi').forEach(t => t.remove());
                });
            });
        }

        // Update category counts
        function updateCategoryCounts() {
            if (complexTypesData && complexTypesData.categorized_types) {
                const types = complexTypesData.categorized_types.generic_types || [];
                let smartPointers = 0, collections = 0, primitives = 0;
                
                types.forEach(type => {
                    const category = getNodeCategory(type.type_name);
                    if (category === "smart_pointers") smartPointers++;
                    else if (category === "collections") collections++;
                    else primitives++;
                });
                
                document.getElementById("smart-pointers-count").textContent = smartPointers;
                document.getElementById("collections-count").textContent = collections;
                document.getElementById("primitives-count").textContent = primitives;
            }
        }

        // Dynamic FFI Dashboard Generation
        function initFFIDashboard() {
            const container = document.getElementById("ffi-dashboard-content");
            if (!container) return;

            // Get FFI data from embedded JSON
            const ffiData = embeddedJsonData?.unsafe_ffi;
            const hasFFIData = ffiData && (
                (ffiData.enhanced_ffi_data && ffiData.enhanced_ffi_data.length > 0) ||
                (ffiData.boundary_events && ffiData.boundary_events.length > 0) ||
                (ffiData.summary && (ffiData.summary.ffi_count > 0 || ffiData.summary.unsafe_count > 0))
            );

            if (!hasFFIData) {
                // Show "No unsafe/FFI code detected" message
                container.innerHTML = `
                    <div class="text-center py-16">
                        <div class="mb-6">
                            <i class="fa fa-shield text-green-400 text-6xl"></i>
                        </div>
                        <h3 class="text-2xl font-semibold text-white mb-4">No Unsafe/FFI Code Detected</h3>
                        <p class="text-gray-300 text-lg mb-6">Your codebase appears to be using safe Rust patterns exclusively.</p>
                        <div class="bg-green-500/10 rounded-lg p-6 border border-green-500/30 max-w-2xl mx-auto">
                            <div class="flex items-center justify-center mb-4">
                                <i class="fa fa-check-circle text-green-400 text-2xl mr-3"></i>
                                <span class="text-green-400 font-semibold text-lg">Memory Safety Status: SAFE</span>
                            </div>
                            <div class="text-gray-300 text-sm space-y-2">
                                <p>• No unsafe blocks detected</p>
                                <p>• No FFI (Foreign Function Interface) calls found</p>
                                <p>• No memory safety violations identified</p>
                                <p>• All memory operations are managed by Rust's ownership system</p>
                            </div>
                        </div>
                        <div class="mt-8 text-gray-400 text-sm">
                            <p>This analysis scanned ${ffiData?.metadata?.total_allocations_analyzed || 0} allocations</p>
                        </div>
                    </div>
                `;
                return;
            }

            // Generate dashboard with actual data
            const summary = ffiData.summary || {};
            const unsafeCount = summary.unsafe_count || 0;
            const ffiCount = summary.ffi_count || 0;
            const boundaryEvents = summary.boundary_events || 0;
            const safetyViolations = summary.safety_violations || 0;
            const riskLevel = summary.risk_assessment || 'low';

            container.innerHTML = `
                <!-- Key Metrics -->
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div class="bg-red-500/20 rounded-lg p-4 border border-red-500/30">
                        <div class="text-red-400 text-2xl font-bold">${unsafeCount}</div>
                        <div class="text-gray-300 text-sm">Unsafe Allocations</div>
                    </div>
                    <div class="bg-blue-500/20 rounded-lg p-4 border border-blue-500/30">
                        <div class="text-blue-400 text-2xl font-bold">${ffiCount}</div>
                        <div class="text-gray-300 text-sm">FFI Allocations</div>
                    </div>
                    <div class="bg-orange-500/20 rounded-lg p-4 border border-orange-500/30">
                        <div class="text-orange-400 text-2xl font-bold">${boundaryEvents}</div>
                        <div class="text-gray-300 text-sm">Boundary Crossings</div>
                    </div>
                    <div class="bg-yellow-500/20 rounded-lg p-4 border border-yellow-500/30">
                        <div class="text-yellow-400 text-2xl font-bold">${safetyViolations}</div>
                        <div class="text-gray-300 text-sm">Safety Violations</div>
                    </div>
                    <div class="bg-purple-500/20 rounded-lg p-4 border border-purple-500/30">
                        <div class="text-purple-400 text-2xl font-bold">N/A</div>
                        <div class="text-gray-300 text-sm">Unsafe Memory</div>
                    </div>
                </div>

                <!-- Main Dashboard Content -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    ${generateMemoryAllocationSources(unsafeCount, ffiCount)}
                    ${generateMemorySafetyStatus(safetyViolations, riskLevel)}
                </div>

                <!-- Cross-Language Memory Flow & Unsafe Memory Hotspots -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${generateCrossLanguageFlow(ffiData)}
                    ${generateUnsafeMemoryHotspots(ffiData)}
                </div>
            `;
        }

        function generateMemoryAllocationSources(unsafeCount, ffiCount) {
            if (unsafeCount === 0 && ffiCount === 0) {
                return `
                    <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                        <h3 class="text-lg font-semibold mb-4 text-white">Memory Allocation Sources</h3>
                        <div class="text-center py-8">
                            <i class="fa fa-shield text-green-400 text-3xl mb-4"></i>
                            <p class="text-gray-300">All memory allocations are safe</p>
                            <p class="text-gray-400 text-sm mt-2">No unsafe or FFI allocations detected</p>
                        </div>
                    </div>
                `;
            }

            const maxCount = Math.max(unsafeCount, ffiCount, 1);
            const unsafeHeight = Math.max((unsafeCount / maxCount) * 100, 4);
            const ffiHeight = Math.max((ffiCount / maxCount) * 100, 4);

            return `
                <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold mb-4 text-white">Memory Allocation Sources</h3>
                    <div class="h-48 flex items-end justify-center space-x-8">
                        <div class="flex flex-col items-center">
                            <div class="bg-red-500 rounded-t" style="width: 40px; height: ${unsafeHeight}px;"></div>
                            <div class="text-red-400 text-sm font-bold mt-2">${unsafeCount}</div>
                            <div class="text-gray-300 text-xs mt-1">Unsafe Rust</div>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="bg-blue-500 rounded-t" style="width: 40px; height: ${ffiHeight}px;"></div>
                            <div class="text-blue-400 text-sm font-bold mt-2">${ffiCount}</div>
                            <div class="text-gray-300 text-xs mt-1">FFI</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateMemorySafetyStatus(safetyViolations, riskLevel) {
            if (safetyViolations === 0) {
                return `
                    <div class="bg-green-500/10 rounded-lg p-6 border border-green-500/30">
                        <h3 class="text-lg font-semibold mb-4 text-white">Memory Safety Status</h3>
                        <div class="text-center">
                            <i class="fa fa-check-circle text-green-400 text-3xl mb-4"></i>
                            <div class="text-green-400 text-xl font-bold mb-2">No Safety Violations</div>
                            <p class="text-gray-300 text-sm">All memory operations appear to be safe</p>
                        </div>
                    </div>
                `;
            }

            const riskColor = riskLevel === 'high' ? 'red' : riskLevel === 'medium' ? 'yellow' : 'orange';
            return `
                <div class="bg-${riskColor}-500/10 rounded-lg p-6 border border-${riskColor}-500/30">
                    <h3 class="text-lg font-semibold mb-4 text-white">Memory Safety Status</h3>
                    <div class="text-center">
                        <div class="text-${riskColor}-400 text-xl font-bold mb-4">${safetyViolations} Safety Violations Detected</div>
                        <div class="space-y-2 text-left">
                            <div class="text-${riskColor}-400 text-sm">• Risk Level: ${riskLevel.toUpperCase()}</div>
                            <div class="text-gray-300 text-sm">• Review unsafe code blocks</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateCrossLanguageFlow(ffiData) {
            const boundaryEvents = ffiData?.boundary_events || [];
            if (boundaryEvents.length === 0) {
                return `
                    <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                        <h3 class="text-lg font-semibold mb-4 text-white">Cross-Language Memory Flow</h3>
                        <div class="text-center py-8">
                            <i class="fa fa-exchange text-gray-400 text-3xl mb-4"></i>
                            <p class="text-gray-300">No cross-language interactions detected</p>
                            <p class="text-gray-400 text-sm mt-2">All code appears to be pure Rust</p>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold mb-4 text-white">Cross-Language Memory Flow</h3>
                    <div class="flex items-center justify-between h-24">
                        <div class="bg-green-500/20 rounded-lg p-4 border border-green-500/30 flex-1 mr-4">
                            <div class="text-green-400 font-bold text-center">RUST</div>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="flex items-center">
                                <div class="w-8 h-0.5 bg-red-500"></div>
                                <div class="w-0 h-0 border-l-4 border-l-red-500 border-t-2 border-t-transparent border-b-2 border-b-transparent"></div>
                            </div>
                            <div class="text-red-400 text-xs font-bold">${boundaryEvents.length}</div>
                        </div>
                        <div class="bg-blue-500/20 rounded-lg p-4 border border-blue-500/30 flex-1 ml-4">
                            <div class="text-blue-400 font-bold text-center">FFI / C</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateUnsafeMemoryHotspots(ffiData) {
            const enhancedData = ffiData?.enhanced_ffi_data || [];
            if (enhancedData.length === 0) {
                return `
                    <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                        <h3 class="text-lg font-semibold mb-4 text-white">Unsafe Memory Hotspots</h3>
                        <div class="text-center py-8">
                            <i class="fa fa-map-marker text-gray-400 text-3xl mb-4"></i>
                            <p class="text-gray-300">No unsafe memory hotspots identified</p>
                            <p class="text-gray-400 text-sm mt-2">Memory usage patterns appear safe</p>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="bg-slate-800/50 rounded-lg p-6 border border-slate-700">
                    <h3 class="text-lg font-semibold mb-4 text-white">Unsafe Memory Hotspots</h3>
                    <div class="grid grid-cols-3 gap-4 h-24">
                        ${enhancedData.slice(0, 6).map((item, index) => `
                            <div class="flex flex-col items-center justify-center">
                                <div class="w-4 h-4 bg-blue-500 rounded-full border-2 border-blue-400"></div>
                                <div class="text-white text-xs font-bold">${item.size || 'N/A'}</div>
                                <div class="text-blue-400 text-xs">FFI</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Initialize SVG interactions for variable graph
        function initVariableSvgInteractions() {
            const svg = document.querySelector("svg");
            const zoomContainer = svg.getElementById("var-zoom-container");
            const tooltip = svg.getElementById("var-tooltip");
            const tooltipBg = svg.getElementById("var-tooltip-bg");
            const tooltipText = svg.getElementById("var-tooltip-text");
            
            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let isDragging = false;
            let startX, startY;
            let initialTranslateX, initialTranslateY;
            
            const nodes = svg.querySelectorAll(".node-ffi");
            nodes.forEach(node => {
                node.addEventListener("mouseover", function(e) {
                    const nodeId = this.id;
                    const type = this.getAttribute("data-type") || "N/A";
                    const size = this.getAttribute("data-size") || "N/A";
                    const ptr = this.getAttribute("data-ptr") || "N/A";
                    const lifetime = this.getAttribute("data-lifetime") || "N/A";
                    const info = this.getAttribute("data-info") || "";
                    
                    let content = `${nodeId}`;
                    if (type !== "N/A") content += `\nType: ${type}`;
                    if (size !== "N/A") content += `\nSize: ${size}`;
                    if (ptr !== "N/A") content += `\nPtr: ${ptr}`;
                    if (lifetime !== "N/A") content += `\nLifetime: ${lifetime}`;
                    if (info) content += `\n${info}`;
                    
                    tooltipText.textContent = content;
                    
                    const lines = content.split("\n").length;
                    const textLength = tooltipText.getComputedTextLength();
                    tooltipBg.setAttribute("width", Math.max(textLength + 16, 120));
                    tooltipBg.setAttribute("height", lines * 18 + 8);
                    
                    const pt = svg.createSVGPoint();
                    pt.x = e.clientX;
                    pt.y = e.clientY;
                    const svgPt = pt.matrixTransform(svg.getScreenCTM().inverse());
                    
                    tooltip.setAttribute("transform", `translate(${svgPt.x + 10}, ${svgPt.y + 10})`);
                    tooltip.setAttribute("visibility", "visible");
                });
                
                node.addEventListener("mouseout", function() {
                    tooltip.setAttribute("visibility", "hidden");
                });
            });
            
            // Zoom functionality
            svg.addEventListener("wheel", function(e) {
                if (!e.target.closest("#var-zoom-container")) return;
                
                e.preventDefault();
                const pt = svg.createSVGPoint();
                pt.x = e.clientX;
                pt.y = e.clientY;
                const svgPt = pt.matrixTransform(zoomContainer.getScreenCTM().inverse());
                
                const delta = e.deltaY < 0 ? 0.1 : -0.1;
                const newScale = Math.max(0.5, Math.min(2, scale + delta));
                
                translateX = svgPt.x - (svgPt.x - translateX) * (newScale / scale);
                translateY = svgPt.y - (svgPt.y - translateY) * (newScale / scale);
                
                scale = newScale;
                updateVariableTransform();
            });
            
            // Pan functionality
            svg.addEventListener("mousedown", function(e) {
                if (e.target.closest("#var-zoom-container") && 
                    (e.target === svg || e.target.tagName === "rect" && e.target.getAttribute("class") === "subgraph")) {
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    initialTranslateX = translateX;
                    initialTranslateY = translateY;
                    svg.style.cursor = "grabbing";
                }
            });
            
            window.addEventListener("mousemove", function(e) {
                if (!isDragging) return;
                
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                translateX = initialTranslateX + dx / scale;
                translateY = initialTranslateY + dy / scale;
                
                updateVariableTransform();
            });
            
            window.addEventListener("mouseup", function() {
                isDragging = false;
                svg.style.cursor = "default";
            });
            
            function updateVariableTransform() {
                zoomContainer.setAttribute("transform", `translate(${translateX}, ${translateY}) scale(${scale})`);
            }
        }

        // Check if unsafe/ffi data exists and has content
        function hasUnsafeFFIData() {
            return window.dataUtils.hasUnsafeFFIData();
        }

        // Initialize unsafe/ffi sections based on data availability
        function initUnsafeFFISections() {
            const hasData = window.dataUtils.hasUnsafeFFIData();
            const hasFlowData = window.dataUtils.hasFFICallFlowData();
            
            // Handle main unsafe/ffi section
            const unsafeFFIContent = document.getElementById('unsafe-ffi-content');
            if (unsafeFFIContent) {
                if (!hasData) {
                    unsafeFFIContent.innerHTML = window.dataUtils.createEmptyStateElement(
                        window.dataUtils.getEmptyStateMessage('unsafe_ffi'),
                        'fa-shield'
                    );
                } else {
                    // Create interactive unsafe/ffi dashboard
                    createUnsafeFFIDashboard(unsafeFFIContent);
                }
            }
            
            // Handle FFI call flow section
            const ffiFlowContent = document.getElementById('ffi-flow-content');
            if (ffiFlowContent) {
                if (!hasFlowData) {
                    ffiFlowContent.innerHTML = window.dataUtils.createEmptyStateElement(
                        window.dataUtils.getEmptyStateMessage('ffi_flow'),
                        'fa-code-fork'
                    );
                } else {
                    // Create interactive FFI call flow visualization
                    createFFICallFlowVisualization(ffiFlowContent);
                }
            }
        }

        // Create interactive unsafe/ffi dashboard
        function createUnsafeFFIDashboard(container) {
            const unsafeFFIData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
            if (!unsafeFFIData) return;
            
            const summary = unsafeFFIData.summary || {};
            const stats = window.dataUtils.getInteractiveStats();
            
            container.innerHTML = `
                <!-- Risk Assessment Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-slate-700 rounded-lg p-4 interactive-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Unsafe Blocks</p>
                                <p class="text-2xl font-bold text-yellow-400">${summary.unsafe_count || 0}</p>
                            </div>
                            <i class="fa fa-exclamation-triangle text-yellow-400 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-slate-700 rounded-lg p-4 interactive-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">FFI Calls</p>
                                <p class="text-2xl font-bold text-blue-400">${summary.ffi_count || 0}</p>
                            </div>
                            <i class="fa fa-exchange text-blue-400 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-slate-700 rounded-lg p-4 interactive-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Safety Violations</p>
                                <p class="text-2xl font-bold text-red-400">${summary.safety_violations || 0}</p>
                            </div>
                            <i class="fa fa-warning text-red-400 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-slate-700 rounded-lg p-4 interactive-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-300 text-sm">Risk Level</p>
                                <p class="text-lg font-bold risk-indicator ${getRiskColorClass(summary.risk_assessment)}">${(summary.risk_assessment || 'low').toUpperCase()}</p>
                            </div>
                            <i class="fa fa-shield text-gray-400 text-2xl"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Interactive Risk Chart -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4 text-white">Risk Distribution</h3>
                    <div class="bg-slate-700 rounded-lg p-4">
                        <canvas id="risk-distribution-chart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- Detailed Analysis -->
                <div class="space-y-4">
                    <h3 class="text-lg font-medium text-white">Detailed Analysis</h3>
                    <div id="unsafe-ffi-details" class="space-y-3">
                        <!-- Will be populated with detailed data -->
                    </div>
                </div>
            `;
            
            // Initialize risk chart
            setTimeout(() => createRiskDistributionChart(stats), 100);
            
            // Populate detailed analysis
            populateUnsafeFFIDetails(unsafeFFIData);
        }
        
        // Create FFI call flow visualization
        function createFFICallFlowVisualization(container) {
            const unsafeFFIData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
            if (!unsafeFFIData) return;
            
            const boundaryEvents = unsafeFFIData.boundary_events || [];
            const enhancedData = unsafeFFIData.enhanced_ffi_data || [];
            
            container.innerHTML = `
                <!-- Flow Diagram -->
                <div class="mb-6">
                    <div class="border rounded-lg p-4 bg-gray-50 h-[400px] graph-container">
                        <svg id="ffi-flow-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 350" width="100%" height="100%">
                            <!-- SVG content will be generated dynamically -->
                        </svg>
                    </div>
                </div>
                
                <!-- Timeline of Events -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium mb-4">Timeline of Events</h3>
                    <div id="ffi-timeline" class="border rounded-lg p-6 bg-gray-50 relative pl-10">
                        <!-- Timeline content will be populated -->
                    </div>
                </div>
                
                <!-- Interactive Controls -->
                <div class="flex justify-between items-center">
                    <div class="flex space-x-2">
                        <button class="px-3 py-1 bg-blue-100 hover:bg-blue-200 rounded text-sm" onclick="highlightRustToFFI()">
                            Highlight Rust→FFI
                        </button>
                        <button class="px-3 py-1 bg-green-100 hover:bg-green-200 rounded text-sm" onclick="highlightFFIToRust()">
                            Highlight FFI→Rust
                        </button>
                        <button class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm" onclick="resetHighlight()">
                            Reset
                        </button>
                    </div>
                    <div class="text-sm text-gray-600">
                        ${boundaryEvents.length} boundary events • ${enhancedData.length} enhanced entries
                    </div>
                </div>
            `;
            
            // Generate SVG flow diagram
            setTimeout(() => generateFFIFlowSVG(boundaryEvents, enhancedData), 100);
            
            // Populate timeline
            populateFFITimeline(boundaryEvents, enhancedData);
        }
        
        // Helper function to get risk color class
        function getRiskColorClass(riskLevel) {
            const colors = {
                'low': 'text-green-400',
                'medium': 'text-yellow-400',
                'high': 'text-red-400',
                'critical': 'text-red-600'
            };
            return colors[riskLevel] || 'text-gray-400';
        }
        
        // Create risk distribution chart
        function createRiskDistributionChart(stats) {
            const canvas = document.getElementById('risk-distribution-chart');
            if (!canvas || !stats) return;
            
            const ctx = canvas.getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Low Risk', 'Medium Risk', 'High Risk'],
                    datasets: [{
                        data: [stats.riskLevels.low, stats.riskLevels.medium, stats.riskLevels.high],
                        backgroundColor: ['#10B981', '#F59E0B', '#EF4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    }
                }
            });
        }
        
        // Populate unsafe/ffi details
        function populateUnsafeFFIDetails(data) {
            const container = document.getElementById('unsafe-ffi-details');
            if (!container) return;
            
            let html = '';
            
            // Safety violations
            if (data.safety_violations && data.safety_violations.length > 0) {
                html += '<div class="bg-red-900/20 border border-red-500 rounded-lg p-4">';
                html += '<h4 class="font-semibold text-red-400 mb-2">Safety Violations</h4>';
                data.safety_violations.forEach(violation => {
                    html += `<div class="text-sm text-gray-300 mb-1">• ${violation.description} (${violation.location})</div>`;
                });
                html += '</div>';
            }
            
            // Unsafe indicators
            if (data.unsafe_indicators && data.unsafe_indicators.length > 0) {
                html += '<div class="bg-yellow-900/20 border border-yellow-500 rounded-lg p-4">';
                html += '<h4 class="font-semibold text-yellow-400 mb-2">Unsafe Indicators</h4>';
                data.unsafe_indicators.forEach(indicator => {
                    html += `<div class="text-sm text-gray-300 mb-1">• ${indicator.description} (${indicator.location})</div>`;
                });
                html += '</div>';
            }
            
            container.innerHTML = html || '<div class="text-gray-400 text-sm italic">No detailed analysis available</div>';
        }
        
        // Generate FFI flow SVG
        function generateFFIFlowSVG(boundaryEvents, enhancedData) {
            const svg = document.getElementById('ffi-flow-svg');
            if (!svg) return;
            
            // Create a simple flow diagram based on actual data
            let svgContent = `
                <defs>
                    <marker id="ffi-arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                    </marker>
                </defs>
                <rect width="100%" height="100%" fill="#fafafa" />
            `;
            
            if (boundaryEvents.length > 0) {
                // Draw nodes and connections based on actual boundary events
                let x = 100;
                boundaryEvents.forEach((event, index) => {
                    const y = 150;
                    const nodeWidth = 120;
                    
                    // Draw node
                    svgContent += `
                        <g class="node-ffi interactive-card" data-event-index="${index}">
                            <rect x="${x}" y="${y-40}" width="${nodeWidth}" height="80" rx="4" 
                                  fill="${event.event_type === 'RustToFfi' ? '#3B82F6' : '#10B981'}" 
                                  stroke="#666" opacity="0.8" />
                            <text x="${x + nodeWidth/2}" y="${y-10}" text-anchor="middle" fill="white" font-size="12">
                                ${event.event_type}
                            </text>
                            <text x="${x + nodeWidth/2}" y="${y+10}" text-anchor="middle" fill="white" font-size="10">
                                ${event.from_context || 'Unknown'}
                            </text>
                        </g>
                    `;
                    
                    // Draw connection to next node
                    if (index < boundaryEvents.length - 1) {
                        svgContent += `
                            <path d="M${x + nodeWidth},${y} L${x + nodeWidth + 80},${y}" 
                                  stroke="#666" marker-end="url(#ffi-arrow)" stroke-width="2" />
                        `;
                    }
                    
                    x += nodeWidth + 100;
                });
            } else {
                // Show placeholder when no data
                svgContent += `
                    <text x="500" y="175" text-anchor="middle" fill="#666" font-size="16">
                        No FFI boundary events detected
                    </text>
                `;
            }
            
            svg.innerHTML = svgContent;
        }
        
        // Populate FFI timeline
        function populateFFITimeline(boundaryEvents, enhancedData) {
            const container = document.getElementById('ffi-timeline');
            if (!container) return;
            
            let html = '<div class="timeline-line bg-gray-300"></div>';
            
            if (boundaryEvents.length > 0) {
                boundaryEvents.forEach((event, index) => {
                    const color = event.event_type === 'RustToFfi' ? 'blue' : 'green';
                    html += `
                        <div class="timeline-item mb-6 pl-4" style="margin-left: 20px;">
                            <div class="before:bg-${color}-500 timeline-item">
                                <h4 class="font-semibold text-${color}-600">${event.event_type}</h4>
                                <p class="text-sm text-gray-600 mb-1">Timestamp: ${event.timestamp}</p>
                                <p class="text-sm">From: ${event.from_context} → To: ${event.to_context}</p>
                                ${event.ptr ? `<p class="text-xs text-gray-500">Pointer: ${event.ptr}</p>` : ''}
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<div class="text-gray-500 text-center py-8">No timeline events available</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Interactive highlight functions
        window.highlightRustToFFI = function() {
            const nodes = document.querySelectorAll('[data-event-index]');
            nodes.forEach(node => {
                const rect = node.querySelector('rect');
                if (rect && rect.getAttribute('fill') === '#3B82F6') {
                    rect.style.filter = 'brightness(1.3)';
                } else {
                    rect.style.opacity = '0.3';
                }
            });
        };
        
        window.highlightFFIToRust = function() {
            const nodes = document.querySelectorAll('[data-event-index]');
            nodes.forEach(node => {
                const rect = node.querySelector('rect');
                if (rect && rect.getAttribute('fill') === '#10B981') {
                    rect.style.filter = 'brightness(1.3)';
                } else {
                    rect.style.opacity = '0.3';
                }
            });
        };
        
        window.resetHighlight = function() {
            const rects = document.querySelectorAll('#ffi-flow-svg rect');
            rects.forEach(rect => {
                rect.style.filter = '';
                rect.style.opacity = '0.8';
            });
        };

        // Update summary statistics based on actual data
        function updateSummaryStatistics() {
            const unsafeFFIData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
            if (unsafeFFIData && unsafeFFIData.summary) {
                const summary = unsafeFFIData.summary;
                const unsafeCountEl = document.getElementById('unsafe-ffi-count');
                if (unsafeCountEl) {
                    const totalUnsafeFFI = (summary.unsafe_count || 0) + (summary.ffi_count || 0);
                    unsafeCountEl.textContent = totalUnsafeFFI;
                    
                    // Add interactive click handler
                    const parentCard = unsafeCountEl.closest('.hover-lift');
                    if (parentCard) {
                        parentCard.classList.add('interactive-card');
                        parentCard.addEventListener('click', () => {
                            document.getElementById('unsafe-ffi-section')?.scrollIntoView({ 
                                behavior: 'smooth' 
                            });
                        });
                    }
                }
            }
        }

        // Initialize unsafe/ffi charts when data exists
        function initUnsafeFFICharts() {
            const unsafeFFIData = window.analysisData.basic_usage_snapshot_unsafe_ffi;
            if (!unsafeFFIData) return;
            
            // Create interactive charts for unsafe/ffi data
            createUnsafeFFIInteractiveCharts(unsafeFFIData);
            
            // Initialize interactive elements
            initFFIDashboard();
        }

        // Create interactive charts for unsafe/ffi data
        function createUnsafeFFIInteractiveCharts(data) {
            const summary = data.summary || {};
            
            // Create risk assessment chart
            createRiskAssessmentChart(summary);
            
            // Create safety violations timeline if data exists
            if (data.safety_violations && data.safety_violations.length > 0) {
                createSafetyViolationsTimeline(data.safety_violations);
            }
            
            // Create boundary events visualization if data exists
            if (data.boundary_events && data.boundary_events.length > 0) {
                createBoundaryEventsVisualization(data.boundary_events);
            }
        }

        // Create risk assessment chart
        function createRiskAssessmentChart(summary) {
            const riskLevel = summary.risk_assessment || 'low';
            const riskColors = {
                'low': '#10B981',
                'medium': '#F59E0B', 
                'high': '#EF4444',
                'critical': '#DC2626'
            };
            
            // Update risk indicators in the UI
            const riskIndicators = document.querySelectorAll('.risk-indicator');
            riskIndicators.forEach(indicator => {
                indicator.style.backgroundColor = riskColors[riskLevel];
                indicator.textContent = riskLevel.toUpperCase();
            });
        }

        // Create safety violations timeline
        function createSafetyViolationsTimeline(violations) {
            // Implementation for safety violations timeline
            console.log('Creating safety violations timeline with', violations.length, 'violations');
        }

        // Create boundary events visualization  
        function createBoundaryEventsVisualization(events) {
            // Implementation for boundary events visualization
            console.log('Creating boundary events visualization with', events.length, 'events');
        }

        // Initialize all interactions when page loads
        window.addEventListener('load', async function() {
            try {
                // Initialize modern variable graph
                initModernVariableGraph();
                updateCategoryCounts();
                
                // Update summary statistics with actual data
                updateSummaryStatistics();
                
                // Initialize unsafe/ffi sections based on data availability
                initUnsafeFFISections();
                
                // Initialize SVG interactions
                initVariableSvgInteractions();
                
            } catch (error) {
                console.error('Failed to initialize dashboard:', error);
            }
        });
    </script>
</body>
</html>
