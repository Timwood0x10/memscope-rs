<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{TITLE}}</title>
    <style>
        /* CSS Variables for theming */
        :root {
            --primary: #3b82f6;
            --secondary: #64748b;
            --accent: #f59e0b;
            --warning: #f59e0b;
            --danger: #ef4444;
            --success: #10b981;
            --bg: #ffffff;
            --bg2: #f8fafc;
            --text: #1e293b;
            --text2: #64748b;
            --border: #e2e8f0;
        }

        [data-theme="dark"] {
            --primary: #60a5fa;
            --secondary: #94a3b8;
            --accent: #fbbf24;
            --warning: #fbbf24;
            --danger: #f87171;
            --success: #34d399;
            --bg: #0f172a;
            --bg2: #1e293b;
            --text: #f1f5f9;
            --text2: #94a3b8;
            --border: #334155;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg); 
            color: var(--text); 
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            background: var(--bg2); 
            border-radius: 12px; 
            border: 1px solid var(--border);
        }
        
        .header h1 { 
            color: var(--primary); 
            font-size: 2rem; 
            font-weight: 700; 
        }
        
        .controls { 
            display: flex; 
            gap: 12px; 
        }
        
        .btn { 
            padding: 8px 16px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.2s ease;
            background: var(--primary); 
            color: white;
        }
        
        .btn:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
        }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        
        .stat-card { 
            background: var(--bg2); 
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 16px rgba(0,0,0,0.1); 
        }
        
        .stat-value { 
            font-size: 2rem; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        
        .stat-label { 
            color: var(--text2); 
            font-size: 0.9rem; 
        }
        
        .section { 
            background: var(--bg2); 
            padding: 24px; 
            border-radius: 12px; 
            margin-bottom: 24px; 
            border: 1px solid var(--border);
        }
        
        .section h3 { 
            margin-bottom: 20px; 
            color: var(--primary); 
            font-size: 1.4rem; 
            font-weight: 600; 
        }
        
        .variables-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 16px; 
        }
        
        .variable-card { 
            background: var(--bg); 
            padding: 16px; 
            border-radius: 8px; 
            border: 1px solid var(--border);
            cursor: pointer; 
            transition: all 0.2s ease;
        }
        
        .variable-card:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
        }
        
        .variable-name { 
            font-weight: 600; 
            margin-bottom: 8px; 
        }
        
        .variable-info { 
            display: flex; 
            justify-content: space-between; 
            color: var(--text2); 
            font-size: 0.9rem; 
        }
        
        .status-active { color: var(--success); }
        .status-allocated { color: var(--warning); }
        .status-shared { color: var(--primary); }
        .status-deallocated { color: var(--text2); }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 1000; 
        }
        
        .modal-content { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: var(--bg); 
            padding: 24px; 
            border-radius: 12px; 
            max-width: 600px; 
            width: 90%; 
            max-height: 80vh; 
            overflow-y: auto; 
        }
        
        .close { 
            position: absolute; 
            top: 12px; 
            right: 20px; 
            font-size: 24px; 
            cursor: pointer; 
            color: var(--text2); 
        }
        
        .drill-down-content h4 { 
            margin-bottom: 16px; 
            color: var(--primary); 
        }
        
        .metric-row, .pattern-row { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid var(--border); 
        }
        
        .recommendations, .optimization-tips { 
            margin-top: 16px; 
        }
        
        .rec-item, .tip-item { 
            display: flex; 
            gap: 12px; 
            padding: 8px; 
            margin: 8px 0; 
            background: var(--bg2); 
            border-radius: 6px; 
        }
        
        .rec-priority, .tip-priority { 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 0.8rem; 
            font-weight: 600; 
        }
        
        .rec-priority.high, .tip-priority.high { 
            background: var(--danger); 
            color: white; 
        }
        
        .rec-priority.medium, .tip-priority.medium { 
            background: var(--warning); 
            color: white; 
        }
        
        .rec-priority.low, .tip-priority.low { 
            background: var(--success); 
            color: white; 
        }

        /* FFI Crossing Visualization */
        .ffi-crossing-section { 
            background: var(--bg2); 
            border-radius: 8px; 
            padding: 16px; 
            margin-bottom: 20px; 
            border-left: 4px solid var(--warning); 
        }
        
        .ffi-swimlane { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin: 16px 0; 
            padding: 12px; 
            background: var(--bg); 
            border-radius: 8px; 
        }
        
        .ffi-lane { 
            flex: 1; 
            text-align: center; 
            padding: 12px; 
            border-radius: 6px; 
        }
        
        .rust-lane { 
            background: linear-gradient(135deg, #f97316, #ea580c); 
            color: white; 
        }
        
        .c-lane { 
            background: linear-gradient(135deg, #6b7280, #4b5563); 
            color: white; 
        }
        
        .lane-label { 
            font-size: 12px; 
            font-weight: 600; 
            margin-bottom: 4px; 
        }
        
        .ffi-event { 
            font-size: 14px; 
        }
        
        .ffi-boundary { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
        }
        
        .boundary-arrow { 
            font-size: 20px; 
            font-weight: bold; 
            color: var(--warning); 
        }
        
        .boundary-label { 
            font-size: 10px; 
            color: var(--text2); 
            font-weight: 600; 
        }
        
        .ffi-warning { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            background: rgba(245, 158, 11, 0.1); 
            padding: 8px 12px; 
            border-radius: 6px; 
            margin-top: 12px; 
        }
        
        .warning-icon { 
            font-size: 16px; 
        }
        
        .warning-text { 
            font-size: 14px; 
            color: var(--warning); 
            font-weight: 600; 
        }

        /* Attribution Panel Styles */
        .attribution-panel {
            animation: slideInFromTop 0.3s ease;
        }

        .attribution-section {
            background: var(--bg2);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .attribution-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .hotspot-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .hotspot-badge {
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .hotspot-desc {
            color: var(--text2);
            font-size: 0.9rem;
        }

        .attribution-actions {
            display: flex;
            gap: 8px;
        }

        .btn-secondary {
            padding: 6px 12px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .contributors-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contributor-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .contributor-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .contributor-rank {
            font-weight: 700;
            color: var(--primary);
            min-width: 30px;
        }

        .contributor-name {
            flex: 1;
            font-weight: 600;
        }

        .contributor-impact {
            color: var(--text2);
            font-size: 0.9rem;
        }

        .contributor-action {
            color: var(--primary);
            font-size: 0.85rem;
        }

        /* Inspector Modal Styles */
        .inspector-container {
            max-width: 800px;
            width: 100%;
        }

        .inspector-header h3 {
            margin-bottom: 16px;
            color: var(--primary);
        }

        .inspector-tabs {
            display: flex;
            gap: 4px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
        }

        .inspector-tab {
            padding: 10px 16px;
            border: none;
            background: transparent;
            color: var(--text2);
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            transition: all 0.2s ease;
        }

        .inspector-tab.active {
            background: var(--primary);
            color: white;
        }

        .inspector-tab:hover:not(.active) {
            background: var(--bg2);
            color: var(--text);
        }

        .inspector-content {
            min-height: 400px;
        }

        .inspector-page {
            display: none;
        }

        .inspector-page.active {
            display: block;
        }

        .lifecycle-timeline {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
        }

        .timeline-events {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .timeline-event {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            border-radius: 6px;
            min-width: 80px;
        }

        .timeline-event.allocated {
            background: rgba(245, 158, 11, 0.1);
        }

        .timeline-event.active {
            background: rgba(16, 185, 129, 0.1);
        }

        .timeline-event.shared {
            background: rgba(59, 130, 246, 0.1);
        }

        .event-time {
            font-size: 0.8rem;
            color: var(--text2);
        }

        .event-label {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .event-details {
            font-size: 0.75rem;
            color: var(--text2);
            text-align: center;
        }

        .thread-metrics .metric-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .metric-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            background: var(--bg2);
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text2);
            margin-top: 4px;
        }

        .task-items, .variables-table-content, .task-variables-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .task-item, .var-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .task-item:hover, .var-row:hover {
            background: var(--primary);
            color: white;
        }

        .task-id, .var-name {
            font-weight: 600;
            flex: 1;
        }

        .task-status, .var-status, .var-lifecycle {
            font-size: 0.85rem;
            padding: 2px 8px;
            border-radius: 12px;
            background: var(--success);
            color: white;
        }

        .task-memory, .var-size {
            font-size: 0.9rem;
            color: var(--text2);
        }

        .variable-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .optimization-recommendations {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .rec-item.priority-high {
            border-left: 4px solid var(--danger);
        }

        .rec-item.priority-medium {
            border-left: 4px solid var(--warning);
        }

        .rec-impact {
            font-size: 0.85rem;
            color: var(--success);
            font-weight: 600;
        }

        .task-basic-info {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .task-basic-info p {
            margin-bottom: 8px;
        }

        .optimization-report {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        .report-summary p {
            margin-bottom: 8px;
        }

        @keyframes slideInFromTop {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Enhanced Diagnostics Styles */
        .diagnostics-section {
            border-left: 4px solid #8b5cf6;
        }

        .diagnostics-description, .layout-description {
            background: rgba(59, 130, 246, 0.1);
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .diagnostics-description p, .layout-description p {
            margin: 0 0 6px 0;
            font-size: 0.9rem;
        }

        .diagnostics-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .active-problems {
            min-height: 200px;
        }

        .no-problems {
            padding: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 16px;
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--success);
            margin-bottom: 20px;
        }

        .status-icon {
            font-size: 2rem;
        }

        .status-text h4 {
            margin: 0 0 8px 0;
            color: var(--success);
        }

        .status-text p {
            margin: 0 0 6px 0;
            font-size: 1rem;
        }

        .status-text small {
            color: var(--text2);
            font-size: 0.85rem;
        }

        .quick-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .insight-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg);
            padding: 16px;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }

        .insight-icon {
            font-size: 1.5rem;
        }

        .insight-card strong {
            display: block;
            margin-bottom: 4px;
            color: var(--text);
        }

        .insight-card p {
            margin: 0;
            color: var(--text2);
            font-size: 0.9rem;
        }

        /* Code Health Summary Styles */
        .code-health-summary {
            background: var(--bg);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--success);
        }

        .health-header h4 {
            margin: 0 0 8px 0;
            color: var(--success);
        }

        .health-header p {
            margin: 0 0 16px 0;
            color: var(--text2);
        }

        .health-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .health-metric {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
        }

        .metric-icon {
            font-size: 1.5rem;
        }

        .health-metric strong {
            display: block;
            margin-bottom: 4px;
            color: var(--text);
        }

        .health-metric p {
            margin: 0;
            color: var(--text2);
            font-size: 0.9rem;
        }

        /* FFI Analysis Styles */
        .ffi-explanation {
            background: rgba(245, 158, 11, 0.1);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--warning);
        }

        .ffi-explanation p {
            margin: 0 0 8px 0;
            font-size: 0.9rem;
        }

        .ffi-safety-checklist {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .ffi-safety-checklist h5 {
            margin: 0 0 12px 0;
            color: var(--primary);
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .check-status {
            font-size: 1.2rem;
            min-width: 24px;
        }

        /* Enhanced FFI Analysis Styles */
        .ffi-crossing-log, .ffi-memory-trace, .ffi-warnings {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .ffi-crossing-log h5, .ffi-memory-trace h5, .ffi-warnings h5 {
            margin: 0 0 12px 0;
            color: var(--primary);
        }

        .crossing-timeline {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .crossing-event {
            display: grid;
            grid-template-columns: 60px 1fr 120px 200px;
            gap: 12px;
            align-items: center;
            padding: 8px;
            background: var(--bg);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .event-time {
            font-weight: 600;
            color: var(--text2);
        }

        .event-type.rust {
            color: #f97316;
            font-weight: 600;
        }

        .event-type.c {
            color: #6b7280;
            font-weight: 600;
        }

        .event-type.ffi {
            color: var(--warning);
            font-weight: 600;
        }

        .event-location {
            font-family: 'Courier New', monospace;
            color: var(--text2);
            font-size: 0.8rem;
        }

        .event-details {
            color: var(--text);
        }

        .memory-changes {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .memory-change {
            display: grid;
            grid-template-columns: 100px 1fr 80px;
            gap: 12px;
            align-items: center;
            padding: 8px;
            background: var(--bg);
            border-radius: 6px;
        }

        .change-side.rust {
            background: rgba(249, 115, 22, 0.1);
            color: #f97316;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .change-side.c {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .change-action {
            font-size: 0.9rem;
        }

        .change-size {
            font-weight: 600;
            text-align: right;
        }

        .warning-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .warning-item.warning-high {
            background: rgba(220, 38, 38, 0.1);
            border-left: 3px solid #dc2626;
        }

        .warning-item.warning-medium {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--warning);
        }

        .warning-item.warning-low {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid var(--success);
        }

        .warning-icon {
            font-size: 1.2rem;
        }

        .warning-text {
            font-size: 0.9rem;
        }

        /* Call Stack Attribution Styles */
        .code-attribution-section {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        .code-attribution-section h5 {
            margin: 0 0 16px 0;
            color: var(--primary);
        }

        .stack-attribution-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stack-item {
            background: var(--bg);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .stack-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stack-item.high {
            border-left-color: #dc2626;
        }

        .stack-item.medium {
            border-left-color: var(--warning);
        }

        .stack-item.low {
            border-left-color: var(--success);
        }

        .stack-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .function-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .function-name {
            font-weight: 600;
            font-family: 'Courier New', monospace;
            color: var(--text);
        }

        .file-location {
            font-size: 0.8rem;
            color: var(--text2);
            font-family: 'Courier New', monospace;
        }

        .allocation-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .allocation-percent {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .allocation-size {
            font-size: 0.9rem;
            color: var(--text2);
        }

        .allocation-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .bar-fill.high {
            background: #dc2626;
        }

        .bar-fill.medium {
            background: var(--warning);
        }

        .bar-fill.low {
            background: var(--success);
        }

        .stack-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .call-count {
            color: var(--text2);
        }

        .action-hint {
            color: var(--primary);
            font-weight: 500;
        }

        /* Function Analysis Styles */
        .function-analysis {
            max-width: 800px;
        }

        .function-location {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .function-location p {
            margin: 0 0 6px 0;
        }

        .allocation-patterns {
            margin-bottom: 20px;
        }

        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 12px;
        }

        .pattern-item {
            background: var(--bg2);
            padding: 12px;
            border-radius: 6px;
            text-align: center;
        }

        .pattern-label {
            display: block;
            font-size: 0.8rem;
            color: var(--text2);
            margin-bottom: 4px;
        }

        .pattern-value {
            display: block;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .pattern-trend {
            font-size: 0.8rem;
        }

        .code-hotspots {
            margin-bottom: 20px;
        }

        .hotspot-lines {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .hotspot-line {
            display: grid;
            grid-template-columns: 80px 1fr 120px;
            gap: 12px;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .hotspot-line.high {
            background: rgba(220, 38, 38, 0.1);
        }

        .hotspot-line.medium {
            background: rgba(245, 158, 11, 0.1);
        }

        .hotspot-line.low {
            background: rgba(34, 197, 94, 0.1);
        }

        .line-number {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--text2);
        }

        .line-code {
            font-family: 'Courier New', monospace;
            color: var(--text);
        }

        .line-impact {
            text-align: right;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .suggestion-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 12px;
        }

        .suggestion-item {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--bg2);
            border-radius: 8px;
        }

        .suggestion-item.priority-high {
            border-left: 4px solid #dc2626;
        }

        .suggestion-item.priority-medium {
            border-left: 4px solid var(--warning);
        }

        .suggestion-icon {
            font-size: 1.5rem;
        }

        .suggestion-content strong {
            display: block;
            margin-bottom: 6px;
            color: var(--text);
        }

        .suggestion-content p {
            margin: 0 0 6px 0;
            color: var(--text2);
            font-size: 0.9rem;
        }

        .expected-impact {
            font-size: 0.85rem;
            color: var(--success);
            font-weight: 600;
        }

        /* Variable Controls and Legend Styles */
        .variables-controls {
            background: var(--bg2);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .variable-legend h5 {
            margin: 0 0 12px 0;
            color: var(--primary);
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg);
            border: 2px solid transparent;
        }

        .legend-item:hover {
            background: var(--primary);
            color: white;
        }

        .legend-item.active {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 2px solid;
        }

        .legend-color.cpu-intensive {
            background: #fbbf24;
            border-color: #f59e0b;
        }

        .legend-color.io-intensive {
            background: #fb923c;
            border-color: #ea580c;
        }

        .legend-color.memory-intensive {
            background: #f87171;
            border-color: #dc2626;
        }

        .legend-color.async-heavy {
            background: #a78bfa;
            border-color: #8b5cf6;
        }

        .legend-color.normal {
            background: #94a3b8;
            border-color: #64748b;
        }

        .legend-color.all {
            background: linear-gradient(45deg, #fbbf24, #fb923c, #f87171, #a78bfa);
            border-color: var(--primary);
        }

        .variable-filters {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg);
            color: var(--text);
        }

        /* Performance Category Variable Cards */
        .variable-card.cpu-intensive {
            border-left: 4px solid #f59e0b;
            background: rgba(251, 191, 36, 0.05);
        }

        .variable-card.io-intensive {
            border-left: 4px solid #ea580c;
            background: rgba(251, 146, 60, 0.05);
        }

        .variable-card.memory-intensive {
            border-left: 4px solid #dc2626;
            background: rgba(248, 113, 113, 0.05);
        }

        .variable-card.async-heavy {
            border-left: 4px solid #8b5cf6;
            background: rgba(167, 139, 250, 0.05);
        }

        .variable-card.normal {
            border-left: 4px solid #64748b;
            background: rgba(148, 163, 184, 0.05);
        }

        .performance-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
        }

        .perf-badge {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
        }

        .perf-badge.cpu-intensive {
            background: #f59e0b;
        }

        .perf-badge.io-intensive {
            background: #ea580c;
        }

        .perf-badge.memory-intensive {
            background: #dc2626;
        }

        .perf-badge.async-heavy {
            background: #8b5cf6;
        }

        .perf-badge.normal {
            background: #64748b;
        }

        .variable-card {
            position: relative;
        }

        .variable-card.filtered-out {
            display: none;
        }

        .problem-card {
            background: var(--bg);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .problem-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .problem-card.critical {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.05);
        }

        .problem-card.high {
            border-color: #ea580c;
            background: rgba(234, 88, 12, 0.05);
        }

        .problem-card.medium {
            border-color: #d97706;
            background: rgba(217, 119, 6, 0.05);
        }

        .problem-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .problem-title {
            font-weight: 600;
            font-size: 1.05rem;
        }

        .problem-confidence {
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .problem-description {
            color: var(--text2);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .affected-components {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .component-tag {
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .root-cause-panel {
            background: var(--bg2);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .likely-causes {
            margin-bottom: 20px;
        }

        .cause-item {
            background: var(--bg);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary);
        }

        .cause-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .cause-title {
            font-weight: 600;
        }

        .cause-confidence {
            font-size: 0.8rem;
            color: var(--text2);
        }

        .debugging-steps {
            background: var(--bg);
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .debugging-steps h5 {
            margin: 0 0 12px 0;
            color: var(--primary);
        }

        .debugging-steps ol {
            margin: 0;
            padding-left: 20px;
        }

        .debugging-steps li {
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .recommendations {
            display: grid;
            gap: 12px;
        }

        .recommendation-item {
            background: var(--bg);
            padding: 12px;
            border-radius: 6px;
            border-left: 3px solid var(--success);
        }

        .rec-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 6px;
        }

        .rec-priority {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary);
        }

        .rec-effort {
            font-size: 0.75rem;
            color: var(--text2);
            margin-left: auto;
        }

        .problem-alert {
            animation: slideInFromRight 0.3s ease;
        }

        @keyframes slideInFromRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* 🕵️ Root Cause Analysis Panel Styles */
        .root-cause-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .root-cause-panel {
            background: white;
            border-radius: 15px;
            max-width: 90vw;
            max-height: 90vh;
            overflow: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-panel {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        .close-panel:hover {
            background: rgba(255,255,255,0.2);
        }

        .panel-content {
            padding: 30px;
        }

        .problem-summary {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid #dc3545;
        }

        .problem-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .severity-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .severity-badge.high {
            background: #dc3545;
            color: white;
        }

        .severity-badge.medium {
            background: #ffc107;
            color: #212529;
        }

        .severity-badge.low {
            background: #28a745;
            color: white;
        }

        .problem-description {
            color: #6c757d;
            margin: 10px 0;
        }

        .affected-threads {
            color: #495057;
            font-size: 14px;
        }

        .analysis-sections {
            display: grid;
            gap: 25px;
        }

        .analysis-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .analysis-section h4 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .causes-list {
            display: grid;
            gap: 15px;
        }

        .cause-item {
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid;
        }

        .cause-item.primary {
            background: #fff5f5;
            border-color: #dc3545;
        }

        .cause-item.secondary {
            background: #fff8e1;
            border-color: #ffc107;
        }

        .cause-item.tertiary {
            background: #f3f4f6;
            border-color: #6c757d;
        }

        .cause-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .confidence-bar {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #ffc107, #dc3545);
            transition: width 0.5s ease;
        }

        .confidence-text {
            font-weight: bold;
            color: #495057;
            min-width: 40px;
        }

        .cause-evidence {
            color: #6c757d;
            font-size: 14px;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .evidence-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #dee2e6;
        }

        .evidence-card h5 {
            color: #495057;
            margin-bottom: 15px;
        }

        .mini-flame-graph {
            margin: 15px 0;
        }

        .flame-bar {
            height: 25px;
            margin: 2px 0;
            border-radius: 3px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .mini-ffi-audit {
            margin: 15px 0;
        }

        .ffi-boundary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 5px;
            margin: 5px 0;
            border: 1px solid #dee2e6;
        }

        .boundary-label {
            font-weight: bold;
            color: #495057;
        }

        .resource-count {
            color: #6c757d;
            font-size: 12px;
        }

        .leak-indicator {
            font-size: 16px;
        }

        .mini-thread-map {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .thread-node {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            background: #6c757d;
        }

        .thread-node.active {
            background: #28a745;
        }

        .thread-node.contention {
            background: #dc3545;
            animation: pulse 1s infinite;
        }

        .thread-connection {
            width: 30px;
            height: 2px;
            background: #dee2e6;
        }

        .expand-evidence {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .expand-evidence:hover {
            background: #0056b3;
        }

        .debugging-checklist {
            display: grid;
            gap: 12px;
        }

        .debug-step {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .debug-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .debug-label {
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
        }

        .recommendations-list {
            display: grid;
            gap: 15px;
        }

        .recommendation-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .rec-icon {
            font-size: 20px;
        }

        .rec-text {
            flex: 1;
            color: #495057;
        }

        .apply-rec-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .apply-rec-btn:hover {
            background: #1e7e34;
        }

        .investigate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .investigate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>{{TITLE}}</h1>
            <div class="controls">
                <button class="btn" id="theme-toggle" onclick="window.toggleTheme()">🌙 Dark Mode</button>
                <button class="btn" id="memory-map-toggle" onclick="window.toggleMemoryMap()">🗺️ Thread Memory</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card" onclick="window.focusAttribution('memory')">
                <div class="stat-value" style="color: var(--primary);">{{TOTAL_MEMORY}}</div>
                <div class="stat-label">Total Memory</div>
            </div>
            <div class="stat-card" onclick="window.focusAttribution('variables')">
                <div class="stat-value" style="color: var(--success);">{{TOTAL_VARIABLES}}</div>
                <div class="stat-label">Total Variables</div>
            </div>
            <div class="stat-card" onclick="window.focusAttribution('threads')">
                <div class="stat-value" style="color: var(--warning);">{{THREAD_COUNT}}</div>
                <div class="stat-label">Active Threads</div>
            </div>
            <div class="stat-card" onclick="window.focusAttribution('efficiency')">
                <div class="stat-value" style="color: var(--accent);">{{EFFICIENCY}}%</div>
                <div class="stat-label">Memory Efficiency</div>
            </div>
        </div>

        <div class="section">
            <h3>🧵 Thread Variables</h3>
            
            <div class="variables-controls">
                <div class="variable-legend">
                    <h5>Performance Categories:</h5>
                    <div class="legend-items">
                        <div class="legend-item" onclick="filterByCategory('cpu')">
                            <div class="legend-color cpu-intensive"></div>
                            <span>CPU Intensive</span>
                        </div>
                        <div class="legend-item" onclick="filterByCategory('io')">
                            <div class="legend-color io-intensive"></div>
                            <span>I/O Heavy</span>
                        </div>
                        <div class="legend-item" onclick="filterByCategory('memory')">
                            <div class="legend-color memory-intensive"></div>
                            <span>Memory Heavy</span>
                        </div>
                        <div class="legend-item" onclick="filterByCategory('async')">
                            <div class="legend-color async-heavy"></div>
                            <span>Async Heavy</span>
                        </div>
                        <div class="legend-item" onclick="filterByCategory('normal')">
                            <div class="legend-color normal"></div>
                            <span>Normal</span>
                        </div>
                        <div class="legend-item" onclick="filterByCategory('all')">
                            <div class="legend-color all"></div>
                            <span>Show All</span>
                        </div>
                    </div>
                </div>
                
                <div class="variable-filters">
                    <div class="filter-group">
                        <label>Sort by:</label>
                        <select id="sort-select" onchange="sortVariables(this.value)">
                            <option value="memory">Memory Usage</option>
                            <option value="allocations">Allocation Count</option>
                            <option value="performance">Performance Impact</option>
                            <option value="thread">Thread ID</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Thread:</label>
                        <select id="thread-filter" onchange="filterByThread(this.value)">
                            <option value="all">All Threads</option>
                            <option value="1">Thread 1</option>
                            <option value="2">Thread 2</option>
                            <option value="3">Thread 3</option>
                            <option value="4">Thread 4</option>
                            <option value="5">Thread 5+</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="variables-grid" id="variables-container">
                {{VARIABLES_HTML}}
            </div>
        </div>

        <div class="section memory-layout-section" style="display: none;">
            <h3>🗺️ Thread Memory Distribution</h3>
            <div class="layout-description">
                <p>🎯 <strong>Shows:</strong> How much memory each thread is using - like a mini bar chart</p>
                <p>🔍 <strong>Use case:</strong> Spot if one thread is hogging all the memory (memory imbalance)</p>
                <p>💡 <strong>Think:</strong> "Which thread is the memory hog?"</p>
            </div>
            <div id="memory-map-content">
                {{MEMORY_MAP_HTML}}
            </div>
        </div>

        <!-- 新增开发者洞察分析区域 -->
        <div class="section developer-insights">
            <h3>🔍 Developer Code Insights</h3>
            
            <!-- 洞察标签页 -->
            <div class="insights-tabs">
                <button class="insight-tab active" onclick="showInsightTab('hotspots')">🔥 Code Hotspots</button>
                <button class="insight-tab" onclick="showInsightTab('leaks')">💧 Memory Leaks</button>
                <button class="insight-tab" onclick="showInsightTab('suggestions')">💡 Optimizations</button>
                <button class="insight-tab" onclick="showInsightTab('performance')">⚡ Performance</button>
            </div>

            <!-- 代码热点分析 -->
            <div id="hotspots-content" class="insight-content active">
                <!-- 新增高级分析模式 -->
                <div class="advanced-patterns-section">
                    <h4>🚨 Advanced Problem Patterns</h4>
                    <div class="pattern-grid">
                        <div class="pattern-card critical">
                            <div class="pattern-header">
                                <span>🔄</span>
                                <strong>Excessive Cloning Pattern</strong>
                                <span class="pattern-severity high">Critical</span>
                            </div>
                            <div class="pattern-description">
                                Variable <code>{{CLONE_VARIABLE_NAME}}</code> cloned {{CLONE_COUNT}} times across {{CLONE_THREADS}} threads
                            </div>
                            <div class="visual-evidence">
                                <div class="evidence-item">
                                    <span class="evidence-label">📊 Resource Trend:</span>
                                    <canvas id="cloning-trend-chart" width="200" height="60"></canvas>
                                    <div class="trend-annotation">🔴 Peak cloning at 10:23:45</div>
                                </div>
                                <div class="evidence-item">
                                    <span class="evidence-label">👥 Related Variables:</span>
                                    <div class="related-variables">
                                        <span class="variable-chip">clone_1 (Thread {{CLONE_THREAD_1}})</span>
                                        <span class="variable-chip">clone_2 (Thread {{CLONE_THREAD_2}})</span>
                                        <span class="variable-chip">clone_3 (Thread {{CLONE_THREAD_3}})</span>
                                        <span class="more-indicator">+{{ADDITIONAL_CLONES}} more</span>
                                    </div>
                                </div>
                            </div>
                            <div class="pattern-impact">
                                <strong>Blast Radius:</strong> {{CLONE_MEMORY_IMPACT}} MB memory, {{CLONE_PERFORMANCE_IMPACT}}% performance degradation
                            </div>
                            <div class="pattern-solution">
                                <strong>💡 Solution:</strong> Use Arc&lt;T&gt; for shared read-only data or Rc&lt;RefCell&lt;T&gt;&gt; for single-threaded scenarios
                                <button class="quick-fix-btn" onclick="applyCloneFix()">🔧 Apply Fix</button>
                            </div>
                        </div>

                        <div class="pattern-card warning">
                            <div class="pattern-header">
                                <span>🔒</span>
                                <strong>Borrow Contention Pattern</strong>
                                <span class="pattern-severity medium">Warning</span>
                            </div>
                            <div class="pattern-description">
                                Multiple threads attempting to borrow <code>{{CONTENTION_VARIABLE}}</code> simultaneously
                            </div>
                            <div class="visual-evidence">
                                <div class="evidence-item">
                                    <span class="evidence-label">📊 Contention Timeline:</span>
                                    <canvas id="contention-timeline-chart" width="200" height="60"></canvas>
                                    <div class="trend-annotation">🔴 Lock contention spikes</div>
                                </div>
                                <div class="evidence-item">
                                    <span class="evidence-label">👥 Competing Threads:</span>
                                    <div class="related-variables">
                                        <span class="variable-chip contention">Thread {{CONTENTION_THREAD_1}} (waiting {{WAIT_TIME_1}}ms)</span>
                                        <span class="variable-chip contention">Thread {{CONTENTION_THREAD_2}} (waiting {{WAIT_TIME_2}}ms)</span>
                                        <span class="variable-chip contention">Thread {{CONTENTION_THREAD_3}} (waiting {{WAIT_TIME_3}}ms)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="pattern-impact">
                                <strong>Blast Radius:</strong> {{CONTENTION_THREADS}} threads affected, {{TOTAL_WAIT_TIME}}ms total wait time
                            </div>
                            <div class="pattern-solution">
                                <strong>💡 Solution:</strong> Consider thread-local storage or lock-free data structures
                                <button class="quick-fix-btn" onclick="applyContentionFix()">🔧 Apply Fix</button>
                            </div>
                        </div>

                        <div class="pattern-card info">
                            <div class="pattern-header">
                                <span>📈</span>
                                <strong>Resource Allocation Spike</strong>
                                <span class="pattern-severity low">Info</span>
                            </div>
                            <div class="pattern-description">
                                Function <code>{{SPIKE_FUNCTION}}</code> caused memory allocation spike at {{SPIKE_TIME}}
                            </div>
                            <div class="visual-evidence">
                                <div class="evidence-item">
                                    <span class="evidence-label">📊 Allocation Spike:</span>
                                    <canvas id="allocation-spike-chart" width="200" height="60"></canvas>
                                    <div class="trend-annotation">🔴 {{SPIKE_SIZE}} MB allocated in {{SPIKE_DURATION}}ms</div>
                                </div>
                                <div class="evidence-item">
                                    <span class="evidence-label">👥 Affected Variables:</span>
                                    <div class="related-variables">
                                        <span class="variable-chip">buffer_{{BUFFER_ID}} ({{BUFFER_SIZE}} KB)</span>
                                        <span class="variable-chip">temp_data ({{TEMP_SIZE}} KB)</span>
                                        <span class="variable-chip">result_set ({{RESULT_SIZE}} KB)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="pattern-impact">
                                <strong>Blast Radius:</strong> {{SPIKE_MEMORY}} MB memory spike, {{SPIKE_GC_CYCLES}} GC cycles triggered
                            </div>
                            <div class="pattern-solution">
                                <strong>💡 Solution:</strong> Pre-allocate buffers or use streaming processing
                                <button class="quick-fix-btn" onclick="applySpikeFix()">🔧 Apply Fix</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="hotspot-grid">
                    <div class="hotspot-card critical">
                        <div class="hotspot-header">
                            <span>🚨</span>
                            <strong>High Memory Allocation</strong>
                        </div>
                        <div class="code-location">Vec&lt;u8&gt; allocation in thread_{{HIGH_USAGE_THREAD}}</div>
                        <p>Large buffer allocations detected - consider pre-allocation</p>
                        <div class="hotspot-metrics">
                            <span class="metric-badge high">{{MAX_ALLOCATION_SIZE}} KB</span>
                            <span>Called {{HIGH_FREQUENCY}} times</span>
                        </div>
                        <button class="quick-fix-btn" onclick="suggestPreallocation()">🔧 Suggest Fix</button>
                    </div>
                    
                    <div class="hotspot-card warning">
                        <div class="hotspot-header">
                            <span>⚠️</span>
                            <strong>Frequent Small Allocations</strong>
                        </div>
                        <div class="code-location">String formatting in loop</div>
                        <p>Multiple small string allocations - consider using StringBuilder pattern</p>
                        <div class="hotspot-metrics">
                            <span class="metric-badge medium">{{SMALL_ALLOC_COUNT}} allocations</span>
                            <span>{{SMALL_ALLOC_RATE}}/sec</span>
                        </div>
                        <button class="quick-fix-btn" onclick="suggestStringBuilder()">🔧 Optimize</button>
                    </div>
                    
                    <div class="hotspot-card good">
                        <div class="hotspot-header">
                            <span>✅</span>
                            <strong>Efficient HashMap Usage</strong>
                        </div>
                        <div class="code-location">HashMap with pre-allocated capacity</div>
                        <p>Good practice: Pre-allocated collections avoid reallocations</p>
                        <div class="hotspot-metrics">
                            <span class="metric-badge low">0 reallocations</span>
                            <span>Optimal</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内存泄漏检测 -->
            <div id="leaks-content" class="insight-content">
                <div class="leak-status {{LEAK_STATUS_CLASS}}">
                    <span class="leak-icon">{{LEAK_ICON}}</span>
                    <div>
                        <strong>{{LEAK_STATUS_TITLE}}</strong>
                        <p>{{LEAK_STATUS_DESCRIPTION}}</p>
                    </div>
                </div>
                
                <div class="performance-alert info">
                    <h4>📊 Memory Analysis</h4>
                    <p><strong>Variables tracked:</strong> {{TOTAL_VARIABLES}} across {{THREAD_COUNT}} threads</p>
                    <p><strong>Memory efficiency:</strong> {{MEMORY_EFFICIENCY}}% ({{MEMORY_OVERHEAD}} overhead)</p>
                    <p><strong>Potential leaks:</strong> {{POTENTIAL_LEAKS}} variables not properly dropped</p>
                </div>
            </div>

            <!-- 优化建议 -->
            <div id="suggestions-content" class="insight-content">
                <div class="suggestion-card">
                    <div class="suggestion-type">🚀 Performance</div>
                    <strong>Use Vec::with_capacity() for known sizes</strong>
                    <p>Pre-allocate vectors when you know the approximate size to avoid reallocations</p>
                    <div class="suggestion-code">let mut vec = Vec::with_capacity({{SUGGESTED_CAPACITY}});</div>
                    <button class="quick-fix-btn" onclick="applyVecCapacityFix()">📋 Copy Code</button>
                </div>
                
                <div class="suggestion-card">
                    <div class="suggestion-type">💾 Memory</div>
                    <strong>Consider using String::with_capacity()</strong>
                    <p>For string building operations, pre-allocate string capacity</p>
                    <div class="suggestion-code">let mut text = String::with_capacity({{STRING_CAPACITY}});</div>
                    <button class="quick-fix-btn" onclick="applyStringCapacityFix()">📋 Copy Code</button>
                </div>
                
                <div class="suggestion-card">
                    <div class="suggestion-type">🔄 Concurrency</div>
                    <strong>Thread-local storage optimization</strong>
                    <p>Consider using thread_local! for frequently accessed data</p>
                    <div class="suggestion-code">thread_local! { static CACHE: RefCell&lt;HashMap&lt;K, V&gt;&gt; = RefCell::new(HashMap::new()); }</div>
                    <button class="quick-fix-btn" onclick="applyThreadLocalFix()">📋 Copy Code</button>
                </div>
            </div>

            <!-- 性能分析 -->
            <div id="performance-content" class="insight-content">
                <div class="performance-alert warning">
                    <h4>⚡ Performance Bottleneck Detected</h4>
                    <p><strong>Thread {{BOTTLENECK_THREAD}}:</strong> {{BOTTLENECK_RATE}} allocations/sec ({{BOTTLENECK_PERCENT}}% above average)</p>
                    <div class="code-location">Suspected location: {{BOTTLENECK_LOCATION}}</div>
                    <button class="quick-fix-btn" onclick="analyzeBottleneck()">🔍 Analyze Further</button>
                </div>
                
                <div class="hotspot-grid">
                    <div class="hotspot-card">
                        <div class="hotspot-header">
                            <span>📈</span>
                            <strong>Allocation Rate Analysis</strong>
                        </div>
                        <p>Thread allocation rates per second:</p>
                        <div style="margin: 12px 0;">
                            <div>Thread 0-9: {{THREAD_0_9_RATE}} ops/sec</div>
                            <div>Thread 10-19: {{THREAD_10_19_RATE}} ops/sec</div>
                            <div>Thread 20+: {{THREAD_20_RATE}} ops/sec</div>
                        </div>
                        <div class="hotspot-metrics">
                            <span class="metric-badge {{RATE_BADGE_CLASS}}">{{OVERALL_RATE_STATUS}}</span>
                        </div>
                    </div>
                    
                    <div class="hotspot-card">
                        <div class="hotspot-header">
                            <span>🎯</span>
                            <strong>Optimization Score</strong>
                        </div>
                        <p>Current code efficiency rating</p>
                        <div style="margin: 12px 0;">
                            <div>Memory usage: {{MEMORY_SCORE}}/100</div>
                            <div>Allocation patterns: {{ALLOCATION_SCORE}}/100</div>
                            <div>Thread efficiency: {{THREAD_SCORE}}/100</div>
                        </div>
                        <div class="hotspot-metrics">
                            <span class="metric-badge {{OVERALL_SCORE_CLASS}}">{{OVERALL_SCORE}}/100</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="section diagnostics-section">
            <h3>🔍 Code Problem Locator</h3>
            <div class="diagnostics-description">
                <p>🎯 <strong>Pinpoint code issues:</strong> Like a flame graph, but for memory problems - find the exact variable/thread causing issues</p>
                <p>⚡ <strong>Instant analysis:</strong> One-click scanning to identify problem sources in your codebase</p>
            </div>
            <div class="diagnostics-controls">
                <button class="btn" onclick="triggerManualScan()">
                    🔎 Scan for Problems
                </button>
                <button class="btn btn-secondary" onclick="generatePerformanceReport()">
                    📊 Performance Report
                </button>
            </div>
            <div id="active-problems" class="active-problems">
                <div class="no-problems">
                    <div class="status-indicator">
                        <div class="status-icon">🎯</div>
                        <div class="status-text">
                            <h4>Ready for Code Analysis</h4>
                            <p>Click "Scan for Problems" to analyze your current memory usage patterns</p>
                            <small>Tracking {{TOTAL_VARIABLES}} variables across {{THREAD_COUNT}} threads</small>
                        </div>
                    </div>
                    <div class="quick-insights">
                        <div class="insight-card">
                            <span class="insight-icon">🧠</span>
                            <div>
                                <strong>Memory Efficiency</strong>
                                <p>85.2% - Above average</p>
                            </div>
                        </div>
                        <div class="insight-card">
                            <span class="insight-icon">⚡</span>
                            <div>
                                <strong>Thread Performance</strong>
                                <p>Optimal load distribution</p>
                            </div>
                        </div>
                        <div class="insight-card">
                            <span class="insight-icon">🔄</span>
                            <div>
                                <strong>Async Health</strong>
                                <p>No blocked futures detected</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="root-cause-analysis" class="root-cause-panel" style="display: none;">
                <!-- Root cause analysis will be populated here -->
            </div>
        </div>
    </div>

    <!-- Modal for variable details -->
    <div id="variable-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Include JavaScript -->
    <script src="./templates/hybrid_dashboard.js"></script>
    <script src="./templates/enhanced_diagnostics.js"></script>
    <script>
        // Initialize with data
        window.DASHBOARD_DATA = {
            variables: {{VARIABLES_DATA}},
            threads: {{THREADS_DATA}},
            tasks: {{TASKS_DATA}}
        };
        
        console.log('🎯 Attribution Analysis Dashboard initialized');
        console.log('🔍 Ready for 3-click root cause discovery');
        
        // 开发者洞察功能
        function showInsightTab(tabName) {
            // 隐藏所有洞察内容
            document.querySelectorAll('.insight-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 移除所有活跃标签
            document.querySelectorAll('.insight-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的内容和标签
            document.getElementById(tabName + '-content').classList.add('active');
            event.target.classList.add('active');
        }
        
        // 代码优化建议功能
        function suggestPreallocation() {
            const suggestion = `// 🔧 Optimization Suggestion
Vec::with_capacity(1024) // Pre-allocate based on expected size
// This avoids multiple reallocations as the vector grows`;
            copyToClipboard(suggestion);
            showNotification('💡 Pre-allocation suggestion copied to clipboard!');
        }
        
        function suggestStringBuilder() {
            const suggestion = `// 🔧 String Building Optimization
let mut result = String::with_capacity(estimated_size);
// Use push_str() instead of repeated format! calls in loops`;
            copyToClipboard(suggestion);
            showNotification('💡 String optimization suggestion copied!');
        }
        
        function applyVecCapacityFix() {
            const code = 'let mut vec = Vec::with_capacity(100); // Adjust capacity as needed';
            copyToClipboard(code);
            showNotification('📋 Vec::with_capacity code copied!');
        }
        
        function applyStringCapacityFix() {
            const code = 'let mut text = String::with_capacity(256); // Adjust capacity as needed';
            copyToClipboard(code);
            showNotification('📋 String::with_capacity code copied!');
        }
        
        function applyThreadLocalFix() {
            const code = `thread_local! {
    static CACHE: RefCell<HashMap<String, String>> = RefCell::new(HashMap::new());
}`;
            copyToClipboard(code);
            showNotification('📋 Thread-local code copied!');
        }
        
        function analyzeBottleneck() {
            // 从页面中提取真实数据而不是依赖未定义的 DASHBOARD_DATA
            const bottleneckInfo = extractBottleneckInfo();
            showNotification('🔍 Analyzing bottleneck... Check console for detailed analysis');
            console.log('📊 Bottleneck Analysis:', bottleneckInfo);
            
            // 显示更详细的分析
            showDetailedBottleneckAnalysis(bottleneckInfo);
        }
        
        function extractBottleneckInfo() {
            // 从DOM中提取实际的性能数据
            const performanceAlert = document.querySelector('.performance-alert');
            if (!performanceAlert) {
                return {
                    threadId: 'No bottleneck detected',
                    allocationRate: '0',
                    location: 'N/A',
                    analysis: 'System performance is optimal'
                };
            }
            
            const alertText = performanceAlert.textContent;
            const threadMatch = alertText.match(/Thread (\d+)/);
            const rateMatch = alertText.match(/([\d,]+) allocations\/sec/);
            const percentMatch = alertText.match(/(\d+)% above average/);
            
            return {
                threadId: threadMatch ? threadMatch[1] : 'Multiple threads',
                allocationRate: rateMatch ? rateMatch[1] : 'High',
                location: 'execute_track_var_workload()',
                percentAboveAverage: percentMatch ? percentMatch[1] : '0',
                analysis: generateBottleneckAnalysis(threadMatch, rateMatch, percentMatch)
            };
        }
        
        function generateBottleneckAnalysis(threadMatch, rateMatch, percentMatch) {
            if (!threadMatch) {
                return 'Performance is well-balanced across all threads';
            }
            
            const threadId = threadMatch[1];
            const rate = rateMatch ? rateMatch[1] : 'high';
            const percent = percentMatch ? percentMatch[1] : '0';
            
            let analysis = `Thread ${threadId} is experiencing elevated allocation activity. `;
            
            if (parseInt(percent) > 200) {
                analysis += 'This is a critical performance bottleneck that requires immediate attention. ';
                analysis += 'Recommendations: 1) Review loop allocations, 2) Consider pre-allocation, 3) Check for memory leaks.';
            } else if (parseInt(percent) > 100) {
                analysis += 'This is a moderate performance concern. ';
                analysis += 'Recommendations: 1) Optimize allocation patterns, 2) Use object pooling, 3) Consider lazy initialization.';
            } else {
                analysis += 'This is within acceptable performance ranges but worth monitoring.';
            }
            
            return analysis;
        }
        
        function showDetailedBottleneckAnalysis(info) {
            // 创建详细分析弹窗
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.7); z-index: 2000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg); padding: 30px; border-radius: 12px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-top: 0; color: var(--primary);">🔍 Detailed Bottleneck Analysis</h3>
                    <div style="margin: 20px 0;">
                        <strong>Thread ID:</strong> ${info.threadId}<br>
                        <strong>Allocation Rate:</strong> ${info.allocationRate}<br>
                        <strong>Location:</strong> ${info.location}<br>
                        ${info.percentAboveAverage ? `<strong>Above Average:</strong> ${info.percentAboveAverage}%<br>` : ''}
                    </div>
                    <div style="background: var(--bg2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>Analysis:</strong><br>
                        ${info.analysis}
                    </div>
                    <div style="background: var(--bg2); padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <strong>🔧 Suggested Optimizations:</strong><br>
                        • Use Vec::with_capacity() for known sizes<br>
                        • Consider String::with_capacity() for string building<br>
                        • Review loop-based allocations<br>
                        • Implement object pooling for frequently allocated objects
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; float: right;">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 点击背景关闭
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // 高级分析模式功能
        function applyCloneFix() {
            const solution = `// 🔧 Excessive Cloning Fix
use std::sync::Arc;

// Instead of cloning large data:
// let clone = expensive_data.clone(); // ❌ Expensive

// Use Arc for shared immutable data:
let shared_data = Arc::new(expensive_data); // ✅ Efficient
let reference = Arc::clone(&shared_data);

// For single-threaded scenarios:
use std::rc::Rc;
let rc_data = Rc::new(data);
let rc_ref = Rc::clone(&rc_data);`;
            
            copyToClipboard(solution);
            showNotification('🔧 Cloning optimization code copied!');
        }

        function applyContentionFix() {
            const solution = `// 🔧 Borrow Contention Fix
use std::sync::RwLock;
use std::thread;

// Instead of frequent mutex locks:
// let guard = data.lock().unwrap(); // ❌ Blocks other threads

// Use RwLock for read-heavy workloads:
let rw_data = RwLock::new(data);

// Multiple readers can access simultaneously:
let reader1 = rw_data.read().unwrap(); // ✅ Non-blocking reads
let reader2 = rw_data.read().unwrap(); // ✅ Concurrent access

// For thread-local data:
thread_local! {
    static LOCAL_CACHE: RefCell<HashMap<K, V>> = RefCell::new(HashMap::new());
}`;
            
            copyToClipboard(solution);
            showNotification('🔧 Contention optimization code copied!');
        }

        function applySpikeFix() {
            const solution = `// 🔧 Allocation Spike Fix
// Pre-allocate known sizes:
let mut buffer = Vec::with_capacity(expected_size);
let mut result = String::with_capacity(estimated_chars);

// Use streaming for large data:
use std::io::BufRead;
let reader = BufReader::new(file);
for line in reader.lines() {
    process_line_incrementally(line?);
}

// Object pooling for frequent allocations:
lazy_static! {
    static ref BUFFER_POOL: Pool<Vec<u8>> = Pool::new(|| Vec::with_capacity(4096));
}

let mut buffer = BUFFER_POOL.get();
// use buffer...
// buffer automatically returns to pool when dropped`;
            
            copyToClipboard(solution);
            showNotification('🔧 Allocation spike optimization code copied!');
        }

        // 初始化微型图表
        function initializeMiniCharts() {
            // 克隆趋势图表
            initCloningTrendChart();
            
            // 争用时间线图表
            initContentionTimelineChart();
            
            // 分配尖峰图表
            initAllocationSpikeChart();
        }

        function initCloningTrendChart() {
            const canvas = document.getElementById('cloning-trend-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // 模拟克隆趋势数据
            const data = [2, 3, 5, 12, 25, 18, 8, 4, 2, 1]; // 克隆次数
            const max = Math.max(...data);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(59, 130, 246, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            // 绘制趋势线
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((value, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - (value / max) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // 标记峰值点
            const peakIndex = data.indexOf(max);
            const peakX = (peakIndex / (data.length - 1)) * width;
            const peakY = height - (max / max) * height;
            
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(peakX, peakY, 3, 0, 2 * Math.PI);
            ctx.fill();
        }

        function initContentionTimelineChart() {
            const canvas = document.getElementById('contention-timeline-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // 模拟争用数据（等待时间）
            const waitTimes = [0, 1, 3, 8, 15, 12, 6, 2, 0, 1]; // 毫秒
            const max = Math.max(...waitTimes);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(245, 158, 11, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            // 绘制柱状图
            waitTimes.forEach((waitTime, index) => {
                const barWidth = width / waitTimes.length;
                const barHeight = (waitTime / max) * height;
                const x = index * barWidth;
                const y = height - barHeight;
                
                // 根据等待时间设置颜色
                if (waitTime > 10) {
                    ctx.fillStyle = '#ef4444'; // 红色 - 严重争用
                } else if (waitTime > 5) {
                    ctx.fillStyle = '#f59e0b'; // 橙色 - 中等争用
                } else {
                    ctx.fillStyle = '#10b981'; // 绿色 - 轻微争用
                }
                
                ctx.fillRect(x, y, barWidth - 1, barHeight);
            });
        }

        function initAllocationSpikeChart() {
            const canvas = document.getElementById('allocation-spike-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // 模拟内存分配数据（MB）
            const allocations = [1, 1.2, 1.5, 2.1, 8.5, 3.2, 1.8, 1.3, 1.1, 1.0]; // MB
            const max = Math.max(...allocations);
            
            // 绘制背景
            ctx.fillStyle = 'rgba(16, 185, 129, 0.1)';
            ctx.fillRect(0, 0, width, height);
            
            // 绘制面积图
            ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(0, height);
            
            allocations.forEach((value, index) => {
                const x = (index / (allocations.length - 1)) * width;
                const y = height - (value / max) * height;
                ctx.lineTo(x, y);
            });
            
            ctx.lineTo(width, height);
            ctx.closePath();
            ctx.fill();
            
            // 绘制边框线
            ctx.beginPath();
            allocations.forEach((value, index) => {
                const x = (index / (allocations.length - 1)) * width;
                const y = height - (value / max) * height;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // 标记尖峰点
            const spikeIndex = allocations.indexOf(max);
            const spikeX = (spikeIndex / (allocations.length - 1)) * width;
            const spikeY = height - (max / max) * height;
            
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(spikeX, spikeY, 3, 0, 2 * Math.PI);
            ctx.fill();
        }

        // 页面加载时初始化图表
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟初始化图表，确保DOM完全加载
            setTimeout(() => {
                initializeMiniCharts();
            }, 100);
        });
        
        // 辅助函数
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).catch(err => {
                    console.error('Failed to copy to clipboard:', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }
        
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Fallback copy failed:', err);
            }
            document.body.removeChild(textArea);
        }
        
        function showNotification(message) {
            // 创建通知元素
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success);
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                z-index: 1000;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            // 添加到页面
            document.body.appendChild(notification);
            
            // 3秒后自动移除
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // 添加动画样式
        const insightStyles = document.createElement('style');
        insightStyles.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            .insights-tabs {
                display: flex;
                border-bottom: 2px solid var(--border);
                margin-bottom: 20px;
                gap: 8px;
            }
            
            .insight-tab {
                padding: 12px 16px;
                background: none;
                border: none;
                color: var(--text2);
                cursor: pointer;
                border-radius: 8px 8px 0 0;
                transition: all 0.3s ease;
                font-weight: 500;
            }
            
            .insight-tab.active {
                color: var(--primary);
                background: var(--bg2);
                border-bottom: 2px solid var(--primary);
            }
            
            .insight-tab:hover {
                background: var(--bg2);
                color: var(--primary);
            }
            
            .insight-content {
                display: none;
            }
            
            .insight-content.active {
                display: block;
            }

            .hotspot-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
                gap: 16px;
                margin-bottom: 20px;
            }
            
            .hotspot-card {
                background: var(--bg);
                border: 2px solid transparent;
                border-radius: 8px;
                padding: 16px;
                transition: all 0.3s ease;
            }
            
            .hotspot-card.critical { 
                border-color: var(--danger); 
                background: rgba(239, 68, 68, 0.05);
            }
            .hotspot-card.warning { 
                border-color: var(--warning); 
                background: rgba(245, 158, 11, 0.05);
            }
            .hotspot-card.good { 
                border-color: var(--success); 
                background: rgba(16, 185, 129, 0.05);
            }
            
            .hotspot-header {
                display: flex;
                align-items: center;
                gap: 8px;
                margin-bottom: 12px;
                font-weight: 600;
            }
            
            .code-location {
                background: var(--bg2);
                padding: 8px 12px;
                border-radius: 6px;
                font-family: 'Monaco', 'Consolas', monospace;
                font-size: 0.85em;
                border-left: 3px solid var(--primary);
                margin: 8px 0;
            }
            
            .hotspot-metrics {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 12px;
                font-size: 0.9em;
            }
            
            .metric-badge {
                background: var(--primary);
                color: white;
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 0.8em;
            }
            
            .metric-badge.high { background: var(--danger); }
            .metric-badge.medium { background: var(--warning); }
            .metric-badge.low { background: var(--success); }

            .leak-status {
                display: flex;
                align-items: center;
                gap: 16px;
                padding: 16px;
                background: var(--bg2);
                border-radius: 8px;
                margin-bottom: 16px;
                border-left: 4px solid var(--success);
            }
            
            .leak-status.warning { border-left-color: var(--warning); }
            .leak-status.critical { border-left-color: var(--danger); }
            
            .leak-icon {
                font-size: 1.5em;
            }

            .suggestion-card {
                background: var(--bg);
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 12px;
                border-left: 4px solid var(--primary);
            }
            
            .suggestion-type {
                display: inline-block;
                background: var(--primary);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.8em;
                margin-bottom: 8px;
            }
            
            .suggestion-code {
                background: var(--bg2);
                padding: 12px;
                border-radius: 6px;
                font-family: 'Monaco', 'Consolas', monospace;
                font-size: 0.9em;
                margin: 8px 0;
            }

            .quick-fix-btn {
                background: var(--success);
                color: white;
                border: none;
                padding: 6px 12px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.8em;
                margin-top: 8px;
                transition: all 0.2s ease;
            }
            
            .quick-fix-btn:hover {
                opacity: 0.8;
                transform: translateY(-1px);
            }

            .performance-alert {
                background: rgba(239, 68, 68, 0.1);
                border: 1px solid var(--danger);
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 16px;
            }

            .performance-alert.warning {
                background: rgba(245, 158, 11, 0.1);
                border-color: var(--warning);
            }

            .performance-alert.info {
                background: rgba(59, 130, 246, 0.1);
                border-color: var(--primary);
            }
            
            /* 高级分析模式样式 */
            .advanced-patterns-section {
                margin-bottom: 30px;
            }
            
            .pattern-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 16px;
            }
            
            .pattern-card {
                background: var(--bg);
                border: 2px solid transparent;
                border-radius: 12px;
                padding: 20px;
                transition: all 0.3s ease;
            }
            
            .pattern-card.critical {
                border-color: var(--danger);
                background: rgba(239, 68, 68, 0.03);
            }
            
            .pattern-card.warning {
                border-color: var(--warning);
                background: rgba(245, 158, 11, 0.03);
            }
            
            .pattern-card.info {
                border-color: var(--primary);
                background: rgba(59, 130, 246, 0.03);
            }
            
            .pattern-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 16px;
                font-size: 1.1em;
                font-weight: 600;
            }
            
            .pattern-severity {
                margin-left: auto;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 0.8em;
                font-weight: 600;
            }
            
            .pattern-severity.high {
                background: var(--danger);
                color: white;
            }
            
            .pattern-severity.medium {
                background: var(--warning);
                color: white;
            }
            
            .pattern-severity.low {
                background: var(--primary);
                color: white;
            }
            
            .pattern-description {
                margin-bottom: 16px;
                font-size: 0.95em;
                line-height: 1.5;
            }
            
            .visual-evidence {
                background: var(--bg2);
                border-radius: 8px;
                padding: 16px;
                margin: 16px 0;
            }
            
            .evidence-item {
                margin-bottom: 16px;
            }
            
            .evidence-item:last-child {
                margin-bottom: 0;
            }
            
            .evidence-label {
                display: block;
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 0.9em;
                color: var(--text2);
            }
            
            .trend-annotation {
                font-size: 0.8em;
                color: var(--danger);
                margin-top: 4px;
                font-weight: 500;
            }
            
            .related-variables {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .variable-chip {
                background: var(--primary);
                color: white;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 0.8em;
                font-family: 'Monaco', 'Consolas', monospace;
            }
            
            .variable-chip.contention {
                background: var(--warning);
            }
            
            .more-indicator {
                background: var(--text2);
                color: white;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 0.8em;
                font-style: italic;
            }
            
            .pattern-impact {
                background: rgba(var(--danger-rgb, 239, 68, 68), 0.1);
                border-left: 4px solid var(--danger);
                padding: 12px;
                border-radius: 6px;
                margin: 16px 0;
                font-size: 0.9em;
            }
            
            .pattern-solution {
                background: rgba(var(--success-rgb, 16, 185, 129), 0.1);
                border-left: 4px solid var(--success);
                padding: 12px;
                border-radius: 6px;
                margin-top: 16px;
                font-size: 0.9em;
            }
            
            .pattern-solution .quick-fix-btn {
                margin-top: 8px;
                margin-left: 8px;
            }
            
            /* 微型图表样式 */
            .mini-chart-container {
                position: relative;
                display: inline-block;
            }
            
            .chart-overlay {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: var(--danger);
                font-weight: bold;
                font-size: 0.8em;
                pointer-events: none;
            }
        `;
        document.head.appendChild(insightStyles);
    </script>
</body>
</html>